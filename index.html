<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: blob: https://cdnjs.cloudflare.com; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; font-src 'self' https://cdnjs.cloudflare.com data:; img-src 'self' data: blob: https:; connect-src 'self' https:;">
    <title>MIC Browser Ultimate - The Future of Web Automation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="PageAnalyzer.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #4ade80 0%, #06b6d4 100%);
            --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --dark-bg: #0a0a0a;
            --dark-surface: #1a1a2e;
            --dark-elevated: #16213e;
            --dark-border: #2a2a3e;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-purple: #8b5cf6;
            --accent-orange: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', Arial, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* System Status Bar */
        .system-status-bar {
            height: 24px;
            background: rgba(0,0,0,0.9);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 12px;
            font-size: 11px;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--dark-border);
        }

        .status-left {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .status-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: pulse 2s infinite;
        }

        .status-dot.warning {
            background: var(--accent-orange);
        }

        .status-dot.error {
            background: #ef4444;
        }

        /* Enhanced Browser Header */
        .browser-header {
            background: var(--primary-gradient);
            border-bottom: 1px solid var(--dark-border);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
        }

        .nav-section {
            display: flex;
            gap: 6px;
        }

        .nav-btn, .ai-btn {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .nav-btn:hover:not(:disabled), .ai-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .ai-btn {
            background: var(--success-gradient);
            position: relative;
            overflow: hidden;
        }

        .ai-btn.active {
            animation: aiPulse 2s infinite;
        }

        @keyframes aiPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(74,222,128,0.4); }
            50% { box-shadow: 0 0 0 15px rgba(74,222,128,0); }
        }

        .url-container {
            flex: 1;
            position: relative;
            max-width: 800px;
            margin: 0 20px;
        }

        .url-bar {
            width: 100%;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 10px 50px 10px 16px;
            border-radius: 24px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .url-bar:focus {
            outline: none;
            border-color: rgba(255,255,255,0.4);
            background: rgba(0,0,0,0.5);
            box-shadow: 0 0 0 3px rgba(255,255,255,0.1);
        }

        .url-indicators {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .ssl-indicator, .ai-indicator, .sync-indicator {
            font-size: 14px;
        }

        .ssl-indicator {
            color: var(--accent-green);
        }

        .ai-indicator {
            color: var(--accent-purple);
            cursor: pointer;
        }

        .sync-indicator {
            color: var(--accent-blue);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            white-space: nowrap;
        }

        .action-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .action-btn.primary {
            background: var(--success-gradient);
        }

        .action-btn.voice {
            background: var(--accent-purple);
        }

        .action-btn.analytics {
            background: var(--accent-orange);
        }

        /* Enhanced Tab System */
        /* Enhanced Tab Container */
        .tab-container {
            background: rgba(0,0,0,0.2);
            padding: 4px 8px 0;
            overflow-x: auto;
            scrollbar-width: none;
            display: flex;
            position: relative;
            border-bottom: 1px solid var(--dark-border);
        }

        .tab-container::-webkit-scrollbar {
            display: none;
        }

        .tabs-wrapper {
            display: flex;
            gap: 2px;
            min-width: max-content;
            position: relative;
        }

        .tab {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-bottom: none;
            color: var(--text-secondary);
            padding: 12px 16px;
            border-radius: 12px 12px 0 0;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 140px;
            max-width: 280px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-blue);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .tab.active {
            background: var(--dark-surface);
            border-color: var(--accent-blue);
            color: white;
            box-shadow: 0 4px 20px rgba(59,130,246,0.2);
            z-index: 10;
        }

        .tab.active::before {
            transform: scaleX(1);
        }

        .tab:hover:not(.active) {
            background: rgba(255,255,255,0.08);
            transform: translateY(-2px);
            border-color: rgba(255,255,255,0.2);
        }

        .tab.dragging {
            opacity: 0.6;
            transform: rotate(5deg);
            z-index: 1000;
        }

        .tab.pinned {
            min-width: 48px;
            max-width: 48px;
            padding: 12px;
        }

        .tab.pinned .tab-title {
            display: none;
        }

        .tab.pinned .tab-close {
            display: none;
        }

        .tab-favicon {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
            border-radius: 3px;
            transition: transform 0.2s ease;
        }

        .tab.loading .tab-favicon {
            animation: spin 1s linear infinite;
        }

        .tab-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 13px;
            font-weight: 500;
            transition: opacity 0.2s ease;
        }

        .tab-indicators {
            display: flex;
            gap: 4px;
            align-items: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .tab:hover .tab-indicators,
        .tab.active .tab-indicators {
            opacity: 1;
        }

        .tab-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .tab-indicator.loading {
            background: var(--accent-orange);
            animation: pulse 1.5s infinite;
        }

        .tab-indicator.secure {
            background: var(--accent-green);
        }

        .tab-indicator.ai-active {
            background: var(--accent-purple);
        }

        .tab-indicator.audio {
            background: var(--accent-blue);
            animation: audioWave 1s ease-in-out infinite alternate;
        }

        .tab-close {
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text-secondary);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
            opacity: 0;
        }

        .tab:hover .tab-close,
        .tab.active .tab-close {
            opacity: 1;
        }

        .tab-close:hover {
            background: rgba(255,0,0,0.3);
            color: white;
            transform: scale(1.1);
        }

        .new-tab {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            margin-left: 8px;
            flex-shrink: 0;
            backdrop-filter: blur(10px);
        }

        .new-tab:hover {
            background: rgba(255,255,255,0.2);
            color: white;
            transform: scale(1.1);
        }

        /* Tab Animations */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes audioWave {
            0% { transform: scale(1); }
            100% { transform: scale(1.3); }
        }

        /* Tab Context Menu */
        .tab-context-menu {
            position: absolute;
            background: var(--dark-elevated);
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            padding: 4px 0;
            min-width: 180px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            z-index: 1000;
            display: none;
        }

        .tab-context-menu.show {
            display: block;
        }

        .tab-context-item {
            padding: 8px 16px;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 13px;
            transition: background 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-context-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .tab-context-item.disabled {
            color: var(--text-secondary);
            cursor: not-allowed;
        }

        .tab-context-item.disabled:hover {
            background: none;
        }

        /* Main Layout */
        .main-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Enhanced Sidebar */
        .sidebar {
            width: 460px;
            background: var(--dark-surface);
            border-right: 1px solid var(--dark-border);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed {
            transform: translateX(-400px);
        }

        .sidebar-header {
            background: var(--primary-gradient);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .ai-avatar {
            width: 60px;
            height: 60px;
            background: var(--success-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            animation: aiFloat 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        @keyframes aiFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-5px) scale(1.05); }
        }

        .ai-avatar::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), transparent);
            pointer-events: none;
        }

        .ai-info h2 {
            color: white;
            font-size: 24px;
            margin-bottom: 4px;
        }

        .ai-status {
            color: rgba(255,255,255,0.9);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-capabilities {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }

        .capability-badge {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        /* Sidebar Navigation */
        .sidebar-nav {
            background: rgba(0,0,0,0.2);
            padding: 0;
            display: flex;
            border-bottom: 1px solid var(--dark-border);
        }

        .nav-tab {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 16px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-tab.active {
            color: white;
            background: rgba(255,255,255,0.08);
            border-bottom-color: var(--accent-blue);
        }

        .nav-tab:hover:not(.active) {
            background: rgba(255,255,255,0.05);
            color: var(--text-primary);
        }

        .nav-tab i {
            font-size: 16px;
        }

        /* Sidebar Content */
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .sidebar-panel {
            display: none;
            padding: 20px;
            height: 100%;
        }

        .sidebar-panel.active {
            display: block;
        }

        /* Chat Interface */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            gap: 12px;
            animation: messageSlideIn 0.4s ease;
            max-width: 90%;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: var(--primary-gradient);
        }

        .message.assistant .message-avatar {
            background: var(--success-gradient);
        }

        .message-content {
            background: rgba(255,255,255,0.08);
            padding: 14px 18px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.6;
            position: relative;
        }

        .message.user .message-content {
            background: var(--primary-gradient);
            color: white;
        }

        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .message-action {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .message-action:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        /* Chat Input */
        .chat-input-area {
            padding: 20px;
            border-top: 1px solid var(--dark-border);
            background: rgba(0,0,0,0.2);
        }

        .chat-input-container {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            background: rgba(255,255,255,0.05);
            border-radius: 24px;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }

        .chat-input-container:focus-within {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(59,130,246,0.2);
        }

        .chat-input {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 14px;
            resize: none;
            max-height: 120px;
            min-height: 24px;
        }

        .chat-input:focus {
            outline: none;
        }

        .chat-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .chat-action-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text-secondary);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .chat-action-btn:hover {
            background: rgba(255,255,255,0.2);
            color: white;
            transform: scale(1.1);
        }

        .chat-send {
            background: var(--primary-gradient);
            color: white;
        }

        .chat-send:hover {
            box-shadow: 0 4px 15px rgba(102,126,234,0.4);
        }

        /* Workflow Panel */
        .workflow-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .workflow-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .workflow-card:hover {
            background: rgba(255,255,255,0.08);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .workflow-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 16px;
        }

        .workflow-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .workflow-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 16px;
        }

        .workflow-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .workflow-status {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .workflow-status.active {
            color: var(--accent-green);
        }

        /* Analytics Panel */
        .analytics-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .metric-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            background: rgba(255,255,255,0.08);
            transform: translateY(-3px);
        }

        .metric-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 18px;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
        }

        .metric-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-change {
            font-size: 12px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .metric-change.positive {
            color: var(--accent-green);
        }

        .metric-change.negative {
            color: #ef4444;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--dark-bg);
        }

        .webview-container {
            flex: 1;
            position: relative;
            background: white;
        }

        .webview {
            width: 100%;
            height: 100%;
            border: none;
            display: none;
        }

        .webview.active {
            display: block;
        }

        /* Demo Content */
        .demo-showcase {
            padding: 60px 40px;
            height: 100%;
            overflow-y: auto;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .showcase-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .showcase-title {
            font-size: 4em;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            font-weight: 800;
        }

        .showcase-subtitle {
            font-size: 1.4em;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .feature-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 40px;
            margin-bottom: 80px;
        }

        .feature-demo {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .feature-demo:hover {
            transform: translateY(-10px);
            box-shadow: 0 30px 80px rgba(0,0,0,0.15);
        }

        .feature-demo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .feature-icon-large {
            width: 80px;
            height: 80px;
            background: var(--primary-gradient);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102,126,234,0.3);
        }

        .feature-demo h3 {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 16px;
            font-weight: 700;
        }

        .feature-demo p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .demo-button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102,126,234,0.4);
        }

        /* Floating Elements */
        .floating-assistant {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: var(--success-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(74,222,128,0.4);
            transition: all 0.3s ease;
            z-index: 1000;
            animation: floatingPulse 3s ease-in-out infinite;
        }

        @keyframes floatingPulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 10px 30px rgba(74,222,128,0.4);
            }
            50% { 
                transform: scale(1.1); 
                box-shadow: 0 15px 40px rgba(74,222,128,0.6);
            }
        }

        .floating-assistant:hover {
            transform: scale(1.15);
            box-shadow: 0 20px 50px rgba(74,222,128,0.8);
        }

        /* Notifications */
        .notification-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }

        .notification {
            background: var(--primary-gradient);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 320px;
            max-width: 420px;
            animation: notificationSlide 0.4s ease;
            pointer-events: all;
            backdrop-filter: blur(20px);
        }

        @keyframes notificationSlide {
            from {
                transform: translateX(450px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            background: var(--success-gradient);
        }

        .notification.warning {
            background: var(--warning-gradient);
        }

        .notification.error {
            background: var(--danger-gradient);
        }

        .notification-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 13px;
            opacity: 0.9;
            line-height: 1.4;
        }

        .notification-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        /* Loading States */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .loading-content {
            background: var(--dark-surface);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 18px;
            margin-bottom: 8px;
        }

        .loading-progress {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .sidebar {
                width: 360px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                z-index: 1000;
                width: 100%;
            }
            
            .sidebar.collapsed {
                transform: translateX(-100%);
            }
            
            .nav-controls {
                flex-wrap: wrap;
            }
            
            .action-buttons {
                order: 3;
                width: 100%;
                margin-top: 8px;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

        *:focus-visible {
            outline: 2px solid var(--accent-blue);
            outline-offset: 2px;
        }

        /* Scrollbars */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Document Scanner Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%);
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
        }

        .document-scanner {
            width: 800px;
            max-width: 90vw;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
        }

        .modal-header h3 {
            margin: 0;
            color: white;
            font-size: 1.3em;
            font-weight: 600;
        }

        .modal-header h3 i {
            margin-right: 10px;
            color: #fbbf24;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .scanner-content {
            padding: 25px;
        }

        .upload-area {
            margin-bottom: 25px;
        }

        .upload-zone {
            border: 2px dashed #6366f1;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            background: rgba(99, 102, 241, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
            transform: translateY(-2px);
        }

        .upload-icon {
            font-size: 48px;
            color: #6366f1;
            margin-bottom: 15px;
            display: block;
        }

        .upload-zone h4 {
            margin: 0 0 10px 0;
            color: white;
            font-size: 1.2em;
        }

        .upload-zone p {
            margin: 0;
            color: #a0a0a0;
        }

        .upload-link {
            color: #6366f1;
            cursor: pointer;
            text-decoration: underline;
        }

        .upload-link:hover {
            color: #8b5cf6;
        }

        .supported-formats {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .supported-formats small {
            color: #666;
        }

        .scanner-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .option-group label {
            color: #e0e0e0;
            font-weight: 500;
            font-size: 0.9em;
        }

        .option-group select {
            background: #2a2a3e;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            color: white;
            font-size: 0.9em;
        }

        .option-group select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        .option-group input[type="checkbox"] {
            margin-right: 8px;
            accent-color: #6366f1;
        }

        .scan-progress {
            margin-bottom: 25px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            color: #a0a0a0;
            text-align: center;
            font-size: 0.9em;
        }

        .scan-results {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .results-header h4 {
            margin: 0;
            color: white;
            font-size: 1.1em;
        }

        .results-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        .btn-secondary i {
            font-size: 0.9em;
        }

        #extractedText {
            width: 100%;
            background: #1a1a2e;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 15px;
            color: white;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            line-height: 1.5;
            resize: vertical;
            min-height: 200px;
        }

        #extractedText:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        .confidence-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85em;
            color: #a0a0a0;
        }

        @media (max-width: 768px) {
            .document-scanner {
                width: 95vw;
                margin: 10px;
            }
            
            .scanner-options {
                grid-template-columns: 1fr;
            }
            
            .results-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .results-actions {
                justify-content: center;
            }
        }

        /* Command System Styles */
        .command-result {
            position: fixed;
            top: 80px;
            right: 20px;
            min-width: 300px;
            max-width: 500px;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9em;
            z-index: 10001;
            display: none;
            animation: slideInRight 0.3s ease-out;
        }

        .command-result.success {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.9), rgba(22, 163, 74, 0.9));
            color: white;
            border-color: rgba(34, 197, 94, 0.3);
        }

        .command-result.error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9));
            color: white;
            border-color: rgba(239, 68, 68, 0.3);
        }

        .command-result.info {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(37, 99, 235, 0.9));
            color: white;
            border-color: rgba(59, 130, 246, 0.3);
        }

        .command-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(30, 30, 46, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0 0 8px 8px;
            border-top: none;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .command-suggestion {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease;
        }

        .command-suggestion:hover,
        .command-suggestion.selected {
            background: rgba(99, 102, 241, 0.2);
        }

        .command-suggestion:last-child {
            border-bottom: none;
        }

        .suggestion-name {
            font-weight: 600;
            color: #6366f1;
            font-size: 0.9em;
        }

        .suggestion-description {
            color: #a0a0a0;
            font-size: 0.8em;
            margin-top: 2px;
        }

        .suggestion-usage {
            color: #666;
            font-size: 0.75em;
            font-family: 'Consolas', monospace;
            margin-top: 2px;
        }

        .url-container.command-mode .url-bar {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        .command-indicator {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #6366f1;
            font-size: 0.8em;
            font-weight: 600;
            display: none;
        }

        .url-container.command-mode .command-indicator {
            display: block;
        }

        .url-container.command-mode .url-bar {
            padding-left: 35px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Update Modal Styles */
        .update-modal {
            width: 600px;
            max-width: 90vw;
        }

        .update-content {
            padding: 25px;
        }

        .update-info {
            margin-bottom: 25px;
        }

        .version-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: 'JetBrains Mono', monospace;
        }

        .current-version, .new-version {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .current-version {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .new-version {
            background: rgba(34, 197, 94, 0.2);
            color: #86efac;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .version-badge i {
            color: #9ca3af;
            font-size: 1.2em;
        }

        .update-description h4 {
            color: #e5e7eb;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .release-notes {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 15px;
            border-left: 4px solid #6366f1;
            color: #d1d5db;
            line-height: 1.6;
            max-height: 200px;
            overflow-y: auto;
        }

        .release-notes p {
            margin: 0 0 10px 0;
        }

        .release-notes ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .release-notes li {
            margin-bottom: 5px;
        }

        .update-progress {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-text {
            color: #e5e7eb;
            font-weight: 500;
        }

        .progress-percentage {
            color: #22d3ee;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22d3ee 0%, #06b6d4 100%);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85em;
            color: #9ca3af;
            font-family: 'JetBrains Mono', monospace;
        }

        .update-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .update-actions .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .update-actions .btn-secondary {
            background: rgba(75, 85, 99, 0.8);
            color: #d1d5db;
            border: 1px solid rgba(156, 163, 175, 0.3);
        }

        .update-actions .btn-secondary:hover {
            background: rgba(75, 85, 99, 1);
            transform: translateY(-1px);
        }

        .update-actions .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .update-actions .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .update-actions .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            animation: pulse 2s infinite;
        }

        .update-actions .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
        }

        /* Command palette styles */
        .command-palette {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            max-width: 90vw;
            background: rgba(30, 30, 46, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
            z-index: 10002;
            display: none;
        }

        .command-palette-header {
            padding: 20px 25px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .command-palette-input {
            width: 100%;
            background: transparent;
            border: none;
            outline: none;
            color: white;
            font-size: 1.1em;
            padding: 10px 0;
        }

        .command-palette-input::placeholder {
            color: #666;
        }

        .command-palette-results {
            max-height: 400px;
            overflow-y: auto;
        }

        .command-category {
            padding: 15px 25px 5px;
            color: #a0a0a0;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <!-- System Status Bar -->
    <div class="system-status-bar">
        <div class="status-left">
            <div class="status-indicator">
                <span class="status-dot" id="systemStatus"></span>
                <span id="systemStatusText">System Ready</span>
            </div>
            <div class="status-indicator">
                <i class="fas fa-brain"></i>
                <span id="aiStatus">AI Active</span>
            </div>
            <div class="status-indicator">
                <i class="fas fa-shield-alt"></i>
                <span id="securityStatus">Secure</span>
            </div>
        </div>
        <div class="status-right">
            <div class="status-indicator">
                <i class="fas fa-memory"></i>
                <span id="memoryUsage">Memory: 245MB</span>
            </div>
            <div class="status-indicator">
                <i class="fas fa-sync-alt"></i>
                <span id="syncStatus">Synced</span>
            </div>
            <div class="status-indicator">
                <i class="fas fa-clock"></i>
                <span id="systemTime"></span>
            </div>
        </div>
    </div>

    <!-- Enhanced Browser Header -->
    <header class="browser-header">
        <nav class="nav-controls">
            <!-- Navigation Section -->
            <div class="nav-section">
                <button class="nav-btn" id="backButton" onclick="micBrowser.goBackActiveTab()" title="Go Back" aria-label="Go back">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button class="nav-btn" id="forwardButton" onclick="micBrowser.goForwardActiveTab()" title="Go Forward" aria-label="Go forward">
                    <i class="fas fa-arrow-right"></i>
                </button>
                <button class="nav-btn" id="refreshButton" onclick="micBrowser.refreshActiveTab()" title="Reload" aria-label="Reload page">
                    <i class="fas fa-redo"></i>
                </button>
                <button class="nav-btn" onclick="goHome()" title="Home" aria-label="Go to home">
                    <i class="fas fa-home"></i>
                </button>
            </div>

            <!-- URL Container -->
            <div class="url-container" id="urlContainer">
                <div class="command-indicator">CMD</div>
                <input type="text" class="url-bar" id="urlInput" 
                       placeholder="Enter URL, search, or command (try: /help)..." 
                       value=""
                       onkeypress="if(event.key==='Enter') micBrowser.navigateFromUrlBar()">
                <div class="url-indicators">
                    <span class="ssl-indicator" title="Secure Connection">
                        <i class="fas fa-lock"></i>
                    </span>
                    <span class="ai-indicator" title="AI Analysis Active" onclick="toggleAIAnalysis()">
                        <i class="fas fa-brain"></i>
                    </span>
                    <span class="sync-indicator" title="Synced Across Devices">
                        <i class="fas fa-cloud"></i>
                    </span>
                </div>
                <div class="command-suggestions" id="commandSuggestions" style="display: none;"></div>
            </div>

            <!-- AI Assistant Button -->
            <button class="ai-btn active" onclick="toggleAssistant()" title="MIC AI Assistant" aria-label="Toggle AI Assistant">
                <i class="fas fa-robot"></i>
            </button>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="action-btn primary" onclick="quickScan()" title="Quick Document Scan">
                    <i class="fas fa-camera"></i>
                    <span>Scan</span>
                </button>
                <button class="action-btn voice" onclick="startVoiceCommand()" title="Voice Command">
                    <i class="fas fa-microphone"></i>
                    <span>Voice</span>
                </button>
                <button class="action-btn analytics" onclick="showAnalytics()" title="Analytics Dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Analytics</span>
                </button>
            </div>
        </nav>

        <!-- Enhanced Tab Container -->
        <div class="tab-container" id="tabContainer">
            <div class="tabs-wrapper" id="tabsWrapper">
                <!-- Tabs will be dynamically created by TabManager -->
            </div>
            <button class="new-tab" title="New Tab" aria-label="New tab">
                <i class="fas fa-plus"></i>
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Enhanced AI Sidebar -->
        <aside class="sidebar" id="aiSidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <div class="ai-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="ai-info">
                    <h2>MIC Ultimate</h2>
                    <div class="ai-status">
                        <span class="status-dot"></span>
                        <span>Active & Learning</span>
                    </div>
                    <div class="ai-capabilities">
                        <span class="capability-badge">Claude AI</span>
                        <span class="capability-badge">OCR</span>
                        <span class="capability-badge">Voice</span>
                        <span class="capability-badge">Analytics</span>
                    </div>
                </div>
            </div>

            <!-- Sidebar Navigation -->
            <div class="sidebar-nav">
                <button class="nav-tab active" onclick="switchSidebarTab('chat')" data-tab="chat">
                    <i class="fas fa-comments"></i>
                    <span>Chat</span>
                </button>
                <button class="nav-tab" onclick="switchSidebarTab('workflows')" data-tab="workflows">
                    <i class="fas fa-project-diagram"></i>
                    <span>Workflows</span>
                </button>
                <button class="nav-tab" onclick="switchSidebarTab('analytics')" data-tab="analytics">
                    <i class="fas fa-chart-pie"></i>
                    <span>Analytics</span>
                </button>
                <button class="nav-tab" onclick="switchSidebarTab('settings')" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </button>
            </div>

            <!-- Sidebar Content -->
            <div class="sidebar-content">
                <!-- Chat Panel -->
                <div class="sidebar-panel active" id="chatPanel">
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <div class="message assistant">
                                <div class="message-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="message-content">
                                    <p>Hello! I'm MIC, your ultimate AI browsing assistant. I can help you with:</p>
                                    <ul>
                                        <li>ðŸ§  Intelligent automation & workflows</li>
                                        <li>ðŸ“„ Document scanning & OCR</li>
                                        <li>ðŸ”„ Data transfer between applications</li>
                                        <li>ðŸ“Š Analytics & insights</li>
                                        <li>ðŸŽ™ï¸ Voice commands</li>
                                        <li>ðŸ” Security & compliance</li>
                                    </ul>
                                    <p>What would you like to accomplish today?</p>
                                    <div class="message-actions">
                                        <button class="message-action" onclick="quickAction('scan')">Scan Document</button>
                                        <button class="message-action" onclick="quickAction('analyze')">Analyze Page</button>
                                        <button class="message-action" onclick="quickAction('automate')">Create Workflow</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chat-input-area">
                            <div class="chat-input-container">
                                <textarea class="chat-input" id="chatInput" 
                                         placeholder="Ask MIC anything or describe what you want to automate..."
                                         rows="1"></textarea>
                                <div class="chat-actions">
                                    <button class="chat-action-btn" onclick="attachFile()" title="Attach File">
                                        <i class="fas fa-paperclip"></i>
                                    </button>
                                    <button class="chat-action-btn" onclick="toggleVoice()" title="Voice Input">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                    <button class="chat-action-btn" onclick="showSuggestions()" title="Smart Suggestions">
                                        <i class="fas fa-lightbulb"></i>
                                    </button>
                                    <button class="chat-action-btn chat-send" onclick="sendMessage()" title="Send Message">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Workflows Panel -->
                <div class="sidebar-panel" id="workflowsPanel">
                    <h3 style="color: white; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-project-diagram"></i>
                        Active Workflows
                    </h3>
                    <div class="workflow-grid">
                        <div class="workflow-card" onclick="executeWorkflow('data-transfer')">
                            <div class="workflow-icon">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <div class="workflow-title">Smart Data Transfer</div>
                            <div class="workflow-description">Automatically transfer data between CRM and Finance Portal with AI field mapping.</div>
                            <div class="workflow-stats">
                                <span class="workflow-status active">
                                    <span class="status-dot"></span>
                                    Active
                                </span>
                                <span>95% Success Rate</span>
                            </div>
                        </div>
                        
                        <div class="workflow-card" onclick="executeWorkflow('document-processing')">
                            <div class="workflow-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="workflow-title">Document Processing</div>
                            <div class="workflow-description">OCR scan, AI extraction, and automatic form population for any document type.</div>
                            <div class="workflow-stats">
                                <span class="workflow-status active">
                                    <span class="status-dot"></span>
                                    Active
                                </span>
                                <span>127 Documents</span>
                            </div>
                        </div>
                        
                        <div class="workflow-card" onclick="executeWorkflow('predictive-automation')">
                            <div class="workflow-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div class="workflow-title">Predictive Actions</div>
                            <div class="workflow-description">AI predicts your next actions and automates repetitive tasks before you ask.</div>
                            <div class="workflow-stats">
                                <span class="workflow-status active">
                                    <span class="status-dot"></span>
                                    Learning
                                </span>
                                <span>87% Accuracy</span>
                            </div>
                        </div>

                        <div class="workflow-card" onclick="createNewWorkflow()">
                            <div class="workflow-icon">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="workflow-title">Create New Workflow</div>
                            <div class="workflow-description">Record a new automation or use AI to generate workflows from natural language.</div>
                            <div class="workflow-stats">
                                <span style="color: var(--accent-blue);">
                                    <i class="fas fa-wand-magic-sparkles"></i>
                                    AI Powered
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Panel -->
                <div class="sidebar-panel" id="analyticsPanel">
                    <h3 style="color: white; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-chart-line"></i>
                        Performance Analytics
                    </h3>
                    
                    <div class="analytics-overview">
                        <div class="metric-card">
                            <div class="metric-icon" style="background: var(--accent-blue);">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="metric-value">4.2h</div>
                            <div class="metric-label">Time Saved Today</div>
                            <div class="metric-change positive">
                                <i class="fas fa-arrow-up"></i>
                                +23% vs Yesterday
                            </div>
                        </div>

                        <div class="metric-card">
                            <div class="metric-icon" style="background: var(--accent-green);">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="metric-value">47</div>
                            <div class="metric-label">Tasks Automated</div>
                            <div class="metric-change positive">
                                <i class="fas fa-arrow-up"></i>
                                +12 this week
                            </div>
                        </div>

                        <div class="metric-card">
                            <div class="metric-icon" style="background: var(--accent-purple);">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="metric-value">97%</div>
                            <div class="metric-label">Accuracy Rate</div>
                            <div class="metric-change positive">
                                <i class="fas fa-arrow-up"></i>
                                +2% improvement
                            </div>
                        </div>

                        <div class="metric-card">
                            <div class="metric-icon" style="background: var(--accent-orange);">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="metric-value">$1,247</div>
                            <div class="metric-label">Value Generated</div>
                            <div class="metric-change positive">
                                <i class="fas fa-arrow-up"></i>
                                This month
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 30px;">
                        <h4 style="color: white; margin-bottom: 15px;">Recent Activity</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px;">
                                <div style="width: 8px; height: 8px; background: var(--accent-green); border-radius: 50%;"></div>
                                <div style="flex: 1; font-size: 14px;">
                                    <div style="color: white;">Customer data transfer completed</div>
                                    <div style="color: var(--text-secondary); font-size: 12px;">2 minutes ago</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px;">
                                <div style="width: 8px; height: 8px; background: var(--accent-blue); border-radius: 50%;"></div>
                                <div style="flex: 1; font-size: 14px;">
                                    <div style="color: white;">Invoice OCR processed</div>
                                    <div style="color: var(--text-secondary); font-size: 12px;">5 minutes ago</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px;">
                                <div style="width: 8px; height: 8px; background: var(--accent-purple); border-radius: 50%;"></div>
                                <div style="flex: 1; font-size: 14px;">
                                    <div style="color: white;">Workflow optimization suggested</div>
                                    <div style="color: var(--text-secondary); font-size: 12px;">12 minutes ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Settings Panel -->
                <div class="sidebar-panel" id="settingsPanel">
                    <div class="settings-header">
                        <h3><i class="fas fa-cog"></i> Settings & Preferences</h3>
                        <div class="settings-actions">
                            <button class="settings-btn" onclick="micBrowser.settings.exportSettings()" title="Export Settings">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="settings-btn" onclick="document.getElementById('importSettings').click()" title="Import Settings">
                                <i class="fas fa-upload"></i>
                            </button>
                            <button class="settings-btn" onclick="micBrowser.settings.resetToDefaults()" title="Reset to Defaults">
                                <i class="fas fa-undo"></i>
                            </button>
                            <input type="file" id="importSettings" accept=".json" style="display: none;" onchange="micBrowser.handleImportSettings(this)">
                        </div>
                    </div>

                    <div class="settings-tabs">
                        <button class="settings-tab active" data-tab="ai" onclick="micBrowser.switchSettingsTab('ai')">
                            <i class="fas fa-brain"></i> AI
                        </button>
                        <button class="settings-tab" data-tab="browser" onclick="micBrowser.switchSettingsTab('browser')">
                            <i class="fas fa-globe"></i> Browser
                        </button>
                        <button class="settings-tab" data-tab="privacy" onclick="micBrowser.switchSettingsTab('privacy')">
                            <i class="fas fa-shield-alt"></i> Privacy
                        </button>
                        <button class="settings-tab" data-tab="appearance" onclick="micBrowser.switchSettingsTab('appearance')">
                            <i class="fas fa-palette"></i> Theme
                        </button>
                        <button class="settings-tab" data-tab="advanced" onclick="micBrowser.switchSettingsTab('advanced')">
                            <i class="fas fa-cogs"></i> Advanced
                        </button>
                    </div>

                    <div class="settings-content">
                        <!-- AI Settings -->
                        <div class="settings-group active" id="settings-ai">
                            <div class="setting-section">
                                <h4><i class="fas fa-robot"></i> Assistant Behavior</h4>
                                <div class="setting-item">
                                    <label>Predictive Mode</label>
                                    <div class="toggle-switch active" data-setting="ai.predictiveMode">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Auto-Learning</label>
                                    <div class="toggle-switch active" data-setting="ai.autoLearning">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Proactive Assistance</label>
                                    <div class="toggle-switch active" data-setting="ai.proactiveAssistance">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Context Memory</label>
                                    <div class="toggle-switch active" data-setting="ai.contextMemory">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-section">
                                <h4><i class="fas fa-microphone"></i> Voice Commands</h4>
                                <div class="setting-item">
                                    <label>Enable Voice Commands</label>
                                    <div class="toggle-switch active" data-setting="ai.voiceCommands">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Voice Language</label>
                                    <select data-setting="voice.language" class="setting-select">
                                        <option value="en-US">English (US)</option>
                                        <option value="en-GB">English (UK)</option>
                                        <option value="es-ES">Spanish</option>
                                        <option value="fr-FR">French</option>
                                        <option value="de-DE">German</option>
                                        <option value="it-IT">Italian</option>
                                        <option value="pt-BR">Portuguese</option>
                                        <option value="zh-CN">Chinese</option>
                                        <option value="ja-JP">Japanese</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label>Wake Word</label>
                                    <input type="text" data-setting="voice.wakWord" class="setting-input" placeholder="Hey MIC">
                                </div>
                                <div class="setting-item">
                                    <label>Voice Sensitivity</label>
                                    <select data-setting="voice.sensitivity" class="setting-select">
                                        <option value="low">Low</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                            </div>

                            <div class="setting-section">
                                <h4><i class="fas fa-tachometer-alt"></i> Performance</h4>
                                <div class="setting-item range-setting">
                                    <label>AI Response Speed</label>
                                    <div class="range-container">
                                        <input type="range" min="0" max="2" value="1" data-setting="ai.responseSpeed" class="setting-range">
                                        <div class="range-labels">
                                            <span>Accurate</span>
                                            <span>Balanced</span>
                                            <span>Fast</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Browser Settings -->
                        <div class="settings-group" id="settings-browser">
                            <div class="setting-section">
                                <h4><i class="fas fa-tabs"></i> Tab Management</h4>
                                <div class="setting-item">
                                    <label>New Tab Behavior</label>
                                    <select data-setting="browser.newTabBehavior" class="setting-select">
                                        <option value="homepage">Homepage</option>
                                        <option value="blank">Blank Page</option>
                                        <option value="previous">Previous Session</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label>Show Tab Previews</label>
                                    <div class="toggle-switch active" data-setting="browser.showTabPreviews">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Enable Drag Reorder</label>
                                    <div class="toggle-switch active" data-setting="browser.enableDragReorder">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Close Tabs on Exit</label>
                                    <div class="toggle-switch active" data-setting="browser.closeTabsOnExit">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-section">
                                <h4><i class="fas fa-search"></i> Search & Navigation</h4>
                                <div class="setting-item">
                                    <label>Default Search Engine</label>
                                    <select data-setting="browser.defaultSearchEngine" class="setting-select">
                                        <option value="google">Google</option>
                                        <option value="bing">Bing</option>
                                        <option value="duckduckgo">DuckDuckGo</option>
                                        <option value="yahoo">Yahoo</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label>Homepage URL</label>
                                    <input type="url" data-setting="browser.homepage" class="setting-input" placeholder="about:blank">
                                </div>
                            </div>
                        </div>

                        <!-- Privacy Settings -->
                        <div class="settings-group" id="settings-privacy">
                            <div class="setting-section">
                                <h4><i class="fas fa-lock"></i> Security</h4>
                                <div class="setting-item">
                                    <label>End-to-End Encryption</label>
                                    <div class="toggle-switch active" data-setting="security.encryption">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Audit Logging</label>
                                    <div class="toggle-switch active" data-setting="security.auditLogging">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Biometric Authentication</label>
                                    <div class="toggle-switch" data-setting="security.biometricAuth">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Auto Updates</label>
                                    <div class="toggle-switch active" data-setting="security.autoUpdates">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-section">
                                <h4><i class="fas fa-user-secret"></i> Privacy</h4>
                                <div class="setting-item">
                                    <label>Cookie Policy</label>
                                    <select data-setting="security.cookiePolicy" class="setting-select">
                                        <option value="allow">Allow All</option>
                                        <option value="strict">Strict</option>
                                        <option value="block">Block All</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label>Tracking Protection</label>
                                    <div class="toggle-switch active" data-setting="security.trackingProtection">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Appearance Settings -->
                        <div class="settings-group" id="settings-appearance">
                            <div class="setting-section">
                                <h4><i class="fas fa-paint-brush"></i> Theme</h4>
                                <div class="setting-item">
                                    <label>Color Theme</label>
                                    <select data-setting="appearance.theme" class="setting-select">
                                        <option value="dark">Dark</option>
                                        <option value="light">Light</option>
                                        <option value="auto">Auto (System)</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label>Font Size</label>
                                    <select data-setting="appearance.fontSize" class="setting-select">
                                        <option value="small">Small</option>
                                        <option value="medium">Medium</option>
                                        <option value="large">Large</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label>Sidebar Position</label>
                                    <select data-setting="appearance.sidebarPosition" class="setting-select">
                                        <option value="right">Right</option>
                                        <option value="left">Left</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label>Compact Mode</label>
                                    <div class="toggle-switch" data-setting="appearance.compactMode">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-section">
                                <h4><i class="fas fa-magic"></i> Visual Effects</h4>
                                <div class="setting-item">
                                    <label>Animations</label>
                                    <div class="toggle-switch active" data-setting="appearance.animations">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item range-setting">
                                    <label>Transparency Level</label>
                                    <div class="range-container">
                                        <input type="range" min="0" max="0.3" step="0.1" value="0.1" data-setting="appearance.transparency" class="setting-range">
                                        <div class="range-value">10%</div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-section">
                                <h4><i class="fas fa-bell"></i> Notifications</h4>
                                <div class="setting-item">
                                    <label>Enable Notifications</label>
                                    <div class="toggle-switch active" data-setting="notifications.enabled">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Notification Position</label>
                                    <select data-setting="notifications.position" class="setting-select">
                                        <option value="top-right">Top Right</option>
                                        <option value="top-left">Top Left</option>
                                        <option value="bottom-right">Bottom Right</option>
                                        <option value="bottom-left">Bottom Left</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label>Notification Sound</label>
                                    <div class="toggle-switch active" data-setting="notifications.sound">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Settings -->
                        <div class="settings-group" id="settings-advanced">
                            <div class="setting-section">
                                <h4><i class="fas fa-rocket"></i> Performance</h4>
                                <div class="setting-item">
                                    <label>Memory Usage</label>
                                    <select data-setting="performance.memoryUsage" class="setting-select">
                                        <option value="low">Low</option>
                                        <option value="normal">Normal</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label>Background Tabs</label>
                                    <select data-setting="performance.backgroundTabs" class="setting-select">
                                        <option value="active">Keep Active</option>
                                        <option value="suspend">Suspend</option>
                                        <option value="unload">Unload</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label>Hardware Acceleration</label>
                                    <div class="toggle-switch active" data-setting="performance.hardwareAcceleration">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-section">
                                <h4><i class="fas fa-magic"></i> Automation</h4>
                                <div class="setting-item">
                                    <label>Auto-Record Workflows</label>
                                    <div class="toggle-switch" data-setting="workflow.autoRecording">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Smart Suggestions</label>
                                    <div class="toggle-switch active" data-setting="workflow.smartSuggestions">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Backup Workflows</label>
                                    <div class="toggle-switch active" data-setting="workflow.backupWorkflows">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-section">
                                <h4><i class="fas fa-scan"></i> OCR & Document Scanning</h4>
                                <div class="setting-item">
                                    <label>Default Language</label>
                                    <select data-setting="ocr.defaultLanguage" class="setting-select">
                                        <option value="eng">English</option>
                                        <option value="spa">Spanish</option>
                                        <option value="fra">French</option>
                                        <option value="deu">German</option>
                                        <option value="ita">Italian</option>
                                        <option value="por">Portuguese</option>
                                        <option value="rus">Russian</option>
                                        <option value="chi_sim">Chinese (Simplified)</option>
                                        <option value="chi_tra">Chinese (Traditional)</option>
                                        <option value="jpn">Japanese</option>
                                        <option value="kor">Korean</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label>Scan Mode</label>
                                    <select data-setting="ocr.scanMode" class="setting-select">
                                        <option value="3">Auto (Default)</option>
                                        <option value="6">Single Block</option>
                                        <option value="7">Single Line</option>
                                        <option value="8">Single Word</option>
                                        <option value="13">Raw Text</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label>Preserve Word Spacing</label>
                                    <div class="toggle-switch" data-setting="ocr.preserveSpaces">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Auto Image Enhancement</label>
                                    <div class="toggle-switch" data-setting="ocr.autoEnhance">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Output Format</label>
                                    <select data-setting="ocr.outputFormat" class="setting-select">
                                        <option value="text">Plain Text</option>
                                        <option value="json">JSON Data</option>
                                        <option value="structured">Structured Text</option>
                                    </select>
                                </div>
                            </div>

                            <div class="setting-section">
                                <h4><i class="fas fa-code"></i> Developer</h4>
                                <div class="setting-item">
                                    <label>Debug Mode</label>
                                    <div class="toggle-switch" data-setting="developer.debugMode">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Show Console</label>
                                    <div class="toggle-switch" data-setting="developer.showConsole">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <label>Log Level</label>
                                    <select data-setting="developer.logLevel" class="setting-select">
                                        <option value="debug">Debug</option>
                                        <option value="info">Info</option>
                                        <option value="warn">Warning</option>
                                        <option value="error">Error</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Content Area -->
        <main class="content-area">
            <div class="webview-container">
                <!-- Demo Showcase -->
                <div class="demo-showcase" id="demoContent">
                    <div class="showcase-header">
                        <h1 class="showcase-title">MIC Browser Ultimate</h1>
                        <p class="showcase-subtitle">
                            The world's first truly intelligent browser that thinks, learns, and automates alongside you. 
                            Experience the future of web interaction powered by advanced AI, OCR, and predictive automation.
                        </p>
                    </div>

                    <div class="feature-showcase">
                        <div class="feature-demo">
                            <div class="feature-icon-large">
                                <i class="fas fa-brain"></i>
                            </div>
                            <h3>Advanced AI Assistant</h3>
                            <p>Claude-powered AI that understands context, automates workflows, and learns from your behavior to predict and execute tasks before you even ask.</p>
                            <button class="demo-button" onclick="demoAI()">Try AI Features</button>
                        </div>

                        <div class="feature-demo">
                            <div class="feature-icon-large">
                                <i class="fas fa-camera"></i>
                            </div>
                            <h3>Intelligent Document Scanning</h3>
                            <p>Scan any document with advanced OCR, AI-enhanced extraction, and automatic form population. Works with IDs, invoices, forms, and more.</p>
                            <button class="demo-button" onclick="demoScan()">Scan Document</button>
                        </div>

                        <div class="feature-demo">
                            <div class="feature-icon-large">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            <h3>Workflow Automation</h3>
                            <p>Create, record, and execute complex workflows across any web application. AI-powered workflow generation and optimization included.</p>
                            <button class="demo-button" onclick="demoWorkflow()">Create Workflow</button>
                        </div>

                        <div class="feature-demo">
                            <div class="feature-icon-large">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <h3>Universal Data Transfer</h3>
                            <p>Seamlessly transfer data between any web applications with intelligent field mapping, validation, and error handling.</p>
                            <button class="demo-button" onclick="demoTransfer()">Transfer Data</button>
                        </div>

                        <div class="feature-demo">
                            <div class="feature-icon-large">
                                <i class="fas fa-microphone"></i>
                            </div>
                            <h3>Voice Commands</h3>
                            <p>Control everything with natural language voice commands. "Fill this form," "Transfer customer data," or "Generate a report."</p>
                            <button class="demo-button" onclick="demoVoice()">Voice Demo</button>
                        </div>

                        <div class="feature-demo">
                            <div class="feature-icon-large">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3>Predictive Analytics</h3>
                            <p>AI analyzes your patterns and provides insights, optimization suggestions, and predictive automation recommendations.</p>
                            <button class="demo-button" onclick="demoAnalytics()">View Analytics</button>
                        </div>

                        <div class="feature-demo">
                            <div class="feature-icon-large">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3>Enterprise Security</h3>
                            <p>Bank-level encryption, audit logging, compliance management, and biometric authentication for enterprise environments.</p>
                            <button class="demo-button" onclick="demoSecurity()">Security Features</button>
                        </div>

                        <div class="feature-demo">
                            <div class="feature-icon-large">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3>Team Collaboration</h3>
                            <p>Share workflows, collaborate in real-time, and build collective intelligence across your entire organization.</p>
                            <button class="demo-button" onclick="demoCollaboration()">Team Features</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Document Scanner Modal -->
    <div id="documentScannerModal" class="modal-overlay" style="display: none;">
        <div class="modal-content document-scanner">
            <div class="modal-header">
                <h3><i class="fas fa-scan"></i> Document Scanner</h3>
                <button class="modal-close" onclick="closeDocumentScanner()">&times;</button>
            </div>
            
            <div class="scanner-content">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-zone" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                        <i class="fas fa-cloud-upload-alt upload-icon"></i>
                        <h4>Drop your document here</h4>
                        <p>or <span class="upload-link" onclick="document.getElementById('imageInput').click()">browse files</span></p>
                        <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
                        <div class="supported-formats">
                            <small>Supports: JPG, PNG, PDF, WEBP, BMP, TIFF</small>
                        </div>
                    </div>
                </div>
                
                <div class="scanner-options">
                    <div class="option-group">
                        <label for="ocrLanguage">Language:</label>
                        <select id="ocrLanguage">
                            <option value="eng">English</option>
                            <option value="spa">Spanish</option>
                            <option value="fra">French</option>
                            <option value="deu">German</option>
                            <option value="ita">Italian</option>
                            <option value="por">Portuguese</option>
                            <option value="rus">Russian</option>
                            <option value="chi_sim">Chinese (Simplified)</option>
                            <option value="chi_tra">Chinese (Traditional)</option>
                            <option value="jpn">Japanese</option>
                            <option value="kor">Korean</option>
                        </select>
                    </div>
                    
                    <div class="option-group">
                        <label for="ocrMode">Scan Mode:</label>
                        <select id="ocrMode">
                            <option value="3">Auto (Default)</option>
                            <option value="6">Single Block</option>
                            <option value="7">Single Line</option>
                            <option value="8">Single Word</option>
                            <option value="13">Raw Text</option>
                        </select>
                    </div>
                    
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="preserveSpaces" checked>
                            Preserve Word Spacing
                        </label>
                    </div>
                </div>
                
                <div class="scan-progress" id="scanProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">Initializing OCR...</div>
                </div>
                
                <div class="scan-results" id="scanResults" style="display: none;">
                    <div class="results-header">
                        <h4>Extracted Text</h4>
                        <div class="results-actions">
                            <button class="btn-secondary" onclick="copyText()">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                            <button class="btn-secondary" onclick="downloadText()">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button class="btn-secondary" onclick="sendToAI()">
                                <i class="fas fa-robot"></i> Send to AI
                            </button>
                        </div>
                    </div>
                    <textarea id="extractedText" rows="10" placeholder="Extracted text will appear here..."></textarea>
                    <div class="confidence-info">
                        <span>Confidence: <span id="confidenceScore">0%</span></span>
                        <span>Words: <span id="wordCount">0</span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Assistant -->
    <div class="floating-assistant" onclick="toggleAssistant()" title="MIC AI Assistant">
        <i class="fas fa-robot"></i>
    </div>

    <!-- Command Palette -->
    <div class="command-palette" id="commandPalette">
        <div class="command-palette-header">
            <input type="text" class="command-palette-input" id="commandPaletteInput" 
                   placeholder="Type a command, search, or ask AI anything..."
                   autocomplete="off">
        </div>
        <div class="command-palette-results" id="commandPaletteResults">
            <div class="command-category">Navigation</div>
            <div class="command-suggestion" data-command="go to google.com">
                <div class="suggestion-name">navigate</div>
                <div class="suggestion-description">Navigate to a URL or search</div>
                <div class="suggestion-usage">navigate &lt;url|search term&gt;</div>
            </div>
            <div class="command-category">Tabs</div>
            <div class="command-suggestion" data-command="new tab">
                <div class="suggestion-name">newtab</div>
                <div class="suggestion-description">Create a new tab</div>
                <div class="suggestion-usage">newtab [url]</div>
            </div>
        </div>
    </div>

    <!-- Update Modal -->
    <div id="updateModal" class="modal-overlay" style="display: none;">
        <div class="modal-content update-modal">
            <div class="modal-header">
                <h3><i class="fas fa-download"></i> <span id="updateModalTitle">Update Available</span></h3>
                <button class="modal-close" onclick="closeUpdateModal()">&times;</button>
            </div>
            
            <div class="update-content">
                <div class="update-info" id="updateInfo">
                    <div class="update-version">
                        <div class="version-badge">
                            <span class="current-version">Current: <span id="currentVersion">1.0.0</span></span>
                            <i class="fas fa-arrow-right"></i>
                            <span class="new-version">New: <span id="newVersion">1.0.0</span></span>
                        </div>
                    </div>
                    
                    <div class="update-description">
                        <h4>What's New:</h4>
                        <div class="release-notes" id="releaseNotes">
                            <p>Loading release notes...</p>
                        </div>
                    </div>
                    
                    <div class="update-progress" id="updateProgress" style="display: none;">
                        <div class="progress-info">
                            <span class="progress-text" id="progressText">Preparing download...</span>
                            <span class="progress-percentage" id="progressPercentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                        </div>
                        <div class="progress-details">
                            <span class="download-speed" id="downloadSpeed">0 KB/s</span>
                            <span class="download-size" id="downloadSize">0 MB / 0 MB</span>
                        </div>
                    </div>
                </div>
                
                <div class="update-actions">
                    <button class="btn btn-secondary" id="updateLaterBtn" onclick="closeUpdateModal()">
                        <i class="fas fa-clock"></i> Later
                    </button>
                    <button class="btn btn-primary" id="downloadUpdateBtn" onclick="downloadUpdate()">
                        <i class="fas fa-download"></i> Download Update
                    </button>
                    <button class="btn btn-success" id="restartBtn" onclick="restartAndUpdate()" style="display: none;">
                        <i class="fas fa-sync-alt"></i> Restart & Update
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Initializing MIC Browser...</div>
            <div class="loading-progress" id="loadingProgress">Loading AI systems...</div>
        </div>
    </div>

    <!-- Command Parser Script -->
    <script src="CommandParser.js"></script>

    <!-- JavaScript -->
    <script>
        // Comprehensive Settings Management System
        class SettingsManager {
            constructor() {
                this.settings = new Map();
                this.observers = new Map();
                this.storageKey = 'micBrowserSettings';
                
                this.initializeDefaultSettings();
                this.loadSettings();
                this.setupEventListeners();
            }

            initializeDefaultSettings() {
                // AI & Assistant Settings
                this.setDefault('ai.predictiveMode', true);
                this.setDefault('ai.autoLearning', true);
                this.setDefault('ai.voiceCommands', true);
                this.setDefault('ai.responseSpeed', 'balanced'); // 'fast', 'balanced', 'accurate'
                this.setDefault('ai.model', 'claude-3-sonnet');
                this.setDefault('ai.contextMemory', true);
                this.setDefault('ai.proactiveAssistance', true);

                // Browser Settings
                this.setDefault('browser.defaultSearchEngine', 'google');
                this.setDefault('browser.homepage', 'about:blank');
                this.setDefault('browser.newTabBehavior', 'homepage'); // 'homepage', 'blank', 'previous'
                this.setDefault('browser.tabPosition', 'top');
                this.setDefault('browser.showTabPreviews', true);
                this.setDefault('browser.enableDragReorder', true);
                this.setDefault('browser.closeTabsOnExit', true);

                // Privacy & Security
                this.setDefault('security.encryption', true);
                this.setDefault('security.auditLogging', true);
                this.setDefault('security.biometricAuth', false);
                this.setDefault('security.cookiePolicy', 'strict'); // 'allow', 'strict', 'block'
                this.setDefault('security.trackingProtection', true);
                this.setDefault('security.autoUpdates', true);

                // Appearance & Theme
                this.setDefault('appearance.theme', 'dark'); // 'dark', 'light', 'auto'
                this.setDefault('appearance.fontSize', 'medium'); // 'small', 'medium', 'large'
                this.setDefault('appearance.sidebarPosition', 'right'); // 'left', 'right'
                this.setDefault('appearance.compactMode', false);
                this.setDefault('appearance.animations', true);
                this.setDefault('appearance.transparency', 0.1);

                // Performance
                this.setDefault('performance.memoryUsage', 'normal'); // 'low', 'normal', 'high'
                this.setDefault('performance.backgroundTabs', 'suspend'); // 'active', 'suspend', 'unload'
                this.setDefault('performance.preloadPages', true);
                this.setDefault('performance.hardwareAcceleration', true);

                // Workflow & Automation
                this.setDefault('workflow.autoRecording', false);
                this.setDefault('workflow.smartSuggestions', true);
                this.setDefault('workflow.executeOnConfidence', 0.8);
                this.setDefault('workflow.backupWorkflows', true);

                // Voice & Audio
                this.setDefault('voice.language', 'en-US');
                this.setDefault('voice.sensitivity', 'medium'); // 'low', 'medium', 'high'
                this.setDefault('voice.wakWord', 'Hey MIC');
                this.setDefault('voice.continuous', false);
                this.setDefault('voice.feedback', true);

                // Notifications
                this.setDefault('notifications.enabled', true);
                this.setDefault('notifications.position', 'top-right');
                this.setDefault('notifications.duration', 3000);
                this.setDefault('notifications.sound', true);

                // OCR & Document Scanning
                this.setDefault('ocr.defaultLanguage', 'eng');
                this.setDefault('ocr.scanMode', 3); // Page segmentation mode
                this.setDefault('ocr.preserveSpaces', true);
                this.setDefault('ocr.confidenceThreshold', 0.7);
                this.setDefault('ocr.autoEnhance', true);
                this.setDefault('ocr.outputFormat', 'text'); // 'text', 'json', 'structured'

                // Developer Settings
                this.setDefault('developer.debugMode', false);
                this.setDefault('developer.showConsole', false);
                this.setDefault('developer.logLevel', 'info'); // 'debug', 'info', 'warn', 'error'
            }

            setDefault(key, value) {
                if (!this.settings.has(key)) {
                    this.settings.set(key, value);
                }
            }

            get(key, defaultValue = null) {
                return this.settings.get(key) || defaultValue;
            }

            set(key, value) {
                const oldValue = this.settings.get(key);
                this.settings.set(key, value);
                
                // Save to storage
                this.saveSettings();
                
                // Notify observers
                this.notifyObservers(key, value, oldValue);
                
                // Apply setting immediately
                this.applySettingChange(key, value);
                
                return this;
            }

            // Observe setting changes
            observe(key, callback) {
                if (!this.observers.has(key)) {
                    this.observers.set(key, []);
                }
                this.observers.get(key).push(callback);
            }

            notifyObservers(key, newValue, oldValue) {
                const callbacks = this.observers.get(key);
                if (callbacks) {
                    callbacks.forEach(callback => {
                        try {
                            callback(newValue, oldValue, key);
                        } catch (error) {
                            console.error('Settings observer error:', error);
                        }
                    });
                }
            }

            applySettingChange(key, value) {
                switch (key) {
                    case 'appearance.theme':
                        this.applyTheme(value);
                        break;
                    case 'appearance.fontSize':
                        this.applyFontSize(value);
                        break;
                    case 'appearance.sidebarPosition':
                        this.applySidebarPosition(value);
                        break;
                    case 'appearance.animations':
                        this.applyAnimations(value);
                        break;
                    case 'appearance.transparency':
                        this.applyTransparency(value);
                        break;
                    case 'voice.language':
                        this.applyVoiceLanguage(value);
                        break;
                    case 'notifications.position':
                        this.applyNotificationPosition(value);
                        break;
                }
            }

            applyTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                if (theme === 'auto') {
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
                }
            }

            applyFontSize(size) {
                const sizes = { small: '14px', medium: '16px', large: '18px' };
                document.documentElement.style.fontSize = sizes[size] || sizes.medium;
            }

            applySidebarPosition(position) {
                const sidebar = document.getElementById('aiSidebar');
                const mainContainer = document.querySelector('.main-container');
                if (sidebar && mainContainer) {
                    if (position === 'left') {
                        mainContainer.style.flexDirection = 'row';
                    } else {
                        mainContainer.style.flexDirection = 'row-reverse';
                    }
                }
            }

            applyAnimations(enabled) {
                document.documentElement.style.setProperty('--animation-duration', enabled ? '0.3s' : '0s');
            }

            applyTransparency(level) {
                document.documentElement.style.setProperty('--transparency', level);
            }

            applyVoiceLanguage(language) {
                if (window.micBrowser && window.micBrowser.speechRecognition) {
                    window.micBrowser.speechRecognition.lang = language;
                }
            }

            applyNotificationPosition(position) {
                const container = document.getElementById('notificationContainer');
                if (container) {
                    container.className = `notification-container ${position}`;
                }
            }

            loadSettings() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    if (stored) {
                        const parsedSettings = JSON.parse(stored);
                        Object.entries(parsedSettings).forEach(([key, value]) => {
                            this.settings.set(key, value);
                        });
                    }
                } catch (error) {
                    console.error('Failed to load settings:', error);
                }
            }

            saveSettings() {
                try {
                    const settingsObject = Object.fromEntries(this.settings);
                    localStorage.setItem(this.storageKey, JSON.stringify(settingsObject));
                } catch (error) {
                    console.error('Failed to save settings:', error);
                }
            }

            exportSettings() {
                const settingsObject = Object.fromEntries(this.settings);
                const blob = new Blob([JSON.stringify(settingsObject, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mic-browser-settings-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }

            async importSettings(file) {
                try {
                    const text = await file.text();
                    const importedSettings = JSON.parse(text);
                    
                    Object.entries(importedSettings).forEach(([key, value]) => {
                        this.set(key, value);
                    });
                    
                    return { success: true, message: 'Settings imported successfully' };
                } catch (error) {
                    return { success: false, message: 'Failed to import settings: ' + error.message };
                }
            }

            resetToDefaults() {
                this.settings.clear();
                this.initializeDefaultSettings();
                this.saveSettings();
                
                // Apply all default settings
                this.settings.forEach((value, key) => {
                    this.applySettingChange(key, value);
                });
                
                // Refresh settings UI
                this.refreshSettingsUI();
            }

            refreshSettingsUI() {
                // Update all toggle switches and inputs in the settings panel
                const toggles = document.querySelectorAll('[data-setting]');
                toggles.forEach(element => {
                    const settingKey = element.dataset.setting;
                    const value = this.get(settingKey);
                    
                    if (element.type === 'checkbox' || element.classList.contains('toggle-switch')) {
                        if (element.classList.contains('toggle-switch')) {
                            element.classList.toggle('active', value);
                        } else {
                            element.checked = value;
                        }
                    } else if (element.type === 'range') {
                        element.value = value;
                    } else if (element.tagName === 'SELECT') {
                        element.value = value;
                    }
                });
            }

            setupEventListeners() {
                // Listen for settings changes from UI
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('toggle-switch') && e.target.dataset.setting) {
                        const settingKey = e.target.dataset.setting;
                        const currentValue = this.get(settingKey);
                        this.set(settingKey, !currentValue);
                        e.target.classList.toggle('active', !currentValue);
                    }
                });

                document.addEventListener('change', (e) => {
                    if (e.target.dataset.setting) {
                        const settingKey = e.target.dataset.setting;
                        let value = e.target.value;
                        
                        // Convert value types
                        if (e.target.type === 'checkbox') {
                            value = e.target.checked;
                        } else if (e.target.type === 'number' || e.target.type === 'range') {
                            value = parseFloat(value);
                        }
                        
                        this.set(settingKey, value);
                    }
                });

                // Range input value display
                document.addEventListener('input', (e) => {
                    if (e.target.type === 'range' && e.target.dataset.setting) {
                        const rangeValue = e.target.parentElement.querySelector('.range-value');
                        if (rangeValue) {
                            const settingKey = e.target.dataset.setting;
                            if (settingKey === 'appearance.transparency') {
                                rangeValue.textContent = `${Math.round(e.target.value * 100)}%`;
                            } else if (settingKey === 'ai.responseSpeed') {
                                const labels = ['Accurate', 'Balanced', 'Fast'];
                                rangeValue.textContent = labels[parseInt(e.target.value)] || 'Balanced';
                            }
                        }
                    }
                });

                // Auto-detect system theme changes
                if (window.matchMedia) {
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                        if (this.get('appearance.theme') === 'auto') {
                            this.applyTheme('auto');
                        }
                    });
                }
            }

            getCategory(categoryName) {
                const settings = {};
                this.settings.forEach((value, key) => {
                    if (key.startsWith(categoryName + '.')) {
                        settings[key] = value;
                    }
                });
                return settings;
            }
        }

        // Enhanced Tab Management System
        class TabManager {
            constructor() {
                this.tabs = new Map();
                this.activeTabId = null;
                this.tabIdCounter = 1;
                this.draggedTab = null;
                this.contextMenu = null;
                
                this.initializeTabManager();
            }

            initializeTabManager() {
                // Create initial tab if none exist
                if (this.tabs.size === 0) {
                    this.createTab({
                        url: 'about:blank',
                        title: 'MIC Browser Ultimate',
                        favicon: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234a9eff'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z'/%3E%3C/svg%3E"
                    });
                }

                this.setupTabEvents();
                this.createContextMenu();
            }

            createTab(options = {}) {
                const tabId = `tab-${this.tabIdCounter++}`;
                const tab = {
                    id: tabId,
                    url: options.url || 'about:blank',
                    title: options.title || 'New Tab',
                    favicon: options.favicon || this.getDefaultFavicon(),
                    isLoading: false,
                    isSecure: false,
                    hasAudio: false,
                    isPinned: false,
                    canGoBack: false,
                    canGoForward: false,
                    webviewElement: null,
                    aiActive: false
                };

                this.tabs.set(tabId, tab);
                this.renderTab(tab);
                this.createWebView(tab);
                
                if (!this.activeTabId) {
                    this.switchToTab(tabId);
                }

                return tabId;
            }

            renderTab(tab) {
                const tabsWrapper = document.getElementById('tabsWrapper');
                const tabElement = document.createElement('div');
                tabElement.className = 'tab';
                tabElement.setAttribute('data-tab-id', tab.id);
                tabElement.draggable = true;

                tabElement.innerHTML = `
                    <img class="tab-favicon" src="${tab.favicon}" alt="Website icon" onerror="this.src='${this.getDefaultFavicon()}'">
                    <span class="tab-title">${this.escapeHtml(tab.title)}</span>
                    <div class="tab-indicators">
                        <div class="tab-indicator loading" style="display: ${tab.isLoading ? 'block' : 'none'}"></div>
                        <div class="tab-indicator secure" style="display: ${tab.isSecure ? 'block' : 'none'}"></div>
                        <div class="tab-indicator ai-active" style="display: ${tab.aiActive ? 'block' : 'none'}"></div>
                        <div class="tab-indicator audio" style="display: ${tab.hasAudio ? 'block' : 'none'}"></div>
                    </div>
                    <button class="tab-close" aria-label="Close tab">×</button>
                `;

                // Add event listeners
                tabElement.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('tab-close')) {
                        this.switchToTab(tab.id);
                    }
                });

                tabElement.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.showContextMenu(e, tab.id);
                });

                tabElement.querySelector('.tab-close').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.closeTab(tab.id);
                });

                // Drag and drop support
                tabElement.addEventListener('dragstart', (e) => {
                    this.draggedTab = tab.id;
                    tabElement.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });

                tabElement.addEventListener('dragend', () => {
                    tabElement.classList.remove('dragging');
                    this.draggedTab = null;
                });

                tabElement.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });

                tabElement.addEventListener('drop', (e) => {
                    e.preventDefault();
                    if (this.draggedTab && this.draggedTab !== tab.id) {
                        this.reorderTabs(this.draggedTab, tab.id);
                    }
                });

                tabsWrapper.appendChild(tabElement);
            }

            createWebView(tab) {
                const webviewContainer = document.querySelector('.webview-container');
                
                // Create webview element
                const webview = document.createElement('webview');
                webview.id = `webview-${tab.id}`;
                webview.className = 'webview';
                webview.src = tab.url;
                webview.style.display = 'none';
                webview.setAttribute('nodeintegration', 'false');
                webview.setAttribute('websecurity', 'true');
                webview.setAttribute('disablewebsecurity', 'false');

                // Add webview event listeners
                webview.addEventListener('dom-ready', () => {
                    this.updateTabLoading(tab.id, false);
                });

                webview.addEventListener('did-start-loading', () => {
                    this.updateTabLoading(tab.id, true);
                });

                webview.addEventListener('did-stop-loading', () => {
                    this.updateTabLoading(tab.id, false);
                });

                webview.addEventListener('page-title-updated', (e) => {
                    this.updateTabTitle(tab.id, e.title);
                });

                webview.addEventListener('page-favicon-updated', (e) => {
                    if (e.favicons && e.favicons.length > 0) {
                        this.updateTabFavicon(tab.id, e.favicons[0]);
                    }
                });

                webview.addEventListener('did-navigate', (e) => {
                    this.updateTabUrl(tab.id, e.url);
                    this.updateTabSecurity(tab.id, e.url.startsWith('https://'));
                });

                webview.addEventListener('media-started-playing', () => {
                    this.updateTabAudio(tab.id, true);
                });

                webview.addEventListener('media-paused', () => {
                    this.updateTabAudio(tab.id, false);
                });

                tab.webviewElement = webview;
                webviewContainer.appendChild(webview);
            }

            switchToTab(tabId) {
                if (!this.tabs.has(tabId)) return;

                // Hide current active tab
                if (this.activeTabId) {
                    const currentTab = this.tabs.get(this.activeTabId);
                    const currentTabElement = document.querySelector(`[data-tab-id="${this.activeTabId}"]`);
                    const currentWebview = currentTab.webviewElement;
                    
                    if (currentTabElement) currentTabElement.classList.remove('active');
                    if (currentWebview) currentWebview.style.display = 'none';
                }

                // Show new active tab
                const newTab = this.tabs.get(tabId);
                const newTabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
                const newWebview = newTab.webviewElement;

                if (newTabElement) newTabElement.classList.add('active');
                if (newWebview) {
                    newWebview.style.display = 'block';
                    // Hide demo content when switching to actual webview
                    const demoContent = document.getElementById('demoContent');
                    if (demoContent) demoContent.style.display = 'none';
                }

                this.activeTabId = tabId;
                this.updateNavigationButtons();
                
                // Notify other systems about tab change
                if (window.micBrowser) {
                    window.micBrowser.onTabChanged(tabId, newTab);
                }
            }

            closeTab(tabId) {
                if (!this.tabs.has(tabId) || this.tabs.size <= 1) return;

                const tab = this.tabs.get(tabId);
                const tabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
                const webview = tab.webviewElement;

                // Remove elements
                if (tabElement) tabElement.remove();
                if (webview) webview.remove();

                // If closing active tab, switch to another
                if (this.activeTabId === tabId) {
                    const remainingTabs = Array.from(this.tabs.keys()).filter(id => id !== tabId);
                    if (remainingTabs.length > 0) {
                        this.switchToTab(remainingTabs[remainingTabs.length - 1]);
                    }
                }

                this.tabs.delete(tabId);
            }

            updateTabTitle(tabId, title) {
                const tab = this.tabs.get(tabId);
                if (!tab) return;

                tab.title = title || 'Untitled';
                const tabElement = document.querySelector(`[data-tab-id="${tabId}"] .tab-title`);
                if (tabElement) {
                    tabElement.textContent = tab.title;
                }
            }

            updateTabFavicon(tabId, favicon) {
                const tab = this.tabs.get(tabId);
                if (!tab) return;

                tab.favicon = favicon;
                const faviconElement = document.querySelector(`[data-tab-id="${tabId}"] .tab-favicon`);
                if (faviconElement) {
                    faviconElement.src = favicon;
                }
            }

            updateTabLoading(tabId, isLoading) {
                const tab = this.tabs.get(tabId);
                if (!tab) return;

                tab.isLoading = isLoading;
                const loadingIndicator = document.querySelector(`[data-tab-id="${tabId}"] .tab-indicator.loading`);
                if (loadingIndicator) {
                    loadingIndicator.style.display = isLoading ? 'block' : 'none';
                }

                const tabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
                if (tabElement) {
                    tabElement.classList.toggle('loading', isLoading);
                }
            }

            updateTabSecurity(tabId, isSecure) {
                const tab = this.tabs.get(tabId);
                if (!tab) return;

                tab.isSecure = isSecure;
                const secureIndicator = document.querySelector(`[data-tab-id="${tabId}"] .tab-indicator.secure`);
                if (secureIndicator) {
                    secureIndicator.style.display = isSecure ? 'block' : 'none';
                }
            }

            updateTabAudio(tabId, hasAudio) {
                const tab = this.tabs.get(tabId);
                if (!tab) return;

                tab.hasAudio = hasAudio;
                const audioIndicator = document.querySelector(`[data-tab-id="${tabId}"] .tab-indicator.audio`);
                if (audioIndicator) {
                    audioIndicator.style.display = hasAudio ? 'block' : 'none';
                }
            }

            updateTabUrl(tabId, url) {
                const tab = this.tabs.get(tabId);
                if (!tab) return;

                tab.url = url;
                // Update address bar if this is the active tab
                if (this.activeTabId === tabId) {
                    const urlInput = document.getElementById('urlInput');
                    if (urlInput) {
                        urlInput.value = url;
                    }
                }
            }

            pinTab(tabId) {
                const tab = this.tabs.get(tabId);
                if (!tab) return;

                tab.isPinned = !tab.isPinned;
                const tabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
                if (tabElement) {
                    tabElement.classList.toggle('pinned', tab.isPinned);
                }
            }

            duplicateTab(tabId) {
                const tab = this.tabs.get(tabId);
                if (!tab) return;

                this.createTab({
                    url: tab.url,
                    title: tab.title,
                    favicon: tab.favicon
                });
            }

            reorderTabs(draggedTabId, targetTabId) {
                const tabsWrapper = document.getElementById('tabsWrapper');
                const draggedElement = document.querySelector(`[data-tab-id="${draggedTabId}"]`);
                const targetElement = document.querySelector(`[data-tab-id="${targetTabId}"]`);

                if (draggedElement && targetElement) {
                    tabsWrapper.insertBefore(draggedElement, targetElement.nextSibling);
                }
            }

            createContextMenu() {
                this.contextMenu = document.createElement('div');
                this.contextMenu.className = 'tab-context-menu';
                this.contextMenu.innerHTML = `
                    <div class="tab-context-item" data-action="reload">
                        <i class="fas fa-redo"></i> Reload
                    </div>
                    <div class="tab-context-item" data-action="duplicate">
                        <i class="fas fa-clone"></i> Duplicate
                    </div>
                    <div class="tab-context-item" data-action="pin">
                        <i class="fas fa-thumbtack"></i> <span class="pin-text">Pin Tab</span>
                    </div>
                    <div class="tab-context-item" data-action="close">
                        <i class="fas fa-times"></i> Close Tab
                    </div>
                    <div class="tab-context-item" data-action="close-others">
                        <i class="fas fa-times-circle"></i> Close Other Tabs
                    </div>
                    <div class="tab-context-item" data-action="close-right">
                        <i class="fas fa-arrow-right"></i> Close Tabs to the Right
                    </div>
                `;

                this.contextMenu.addEventListener('click', (e) => {
                    const item = e.target.closest('.tab-context-item');
                    if (item && this.contextMenu.currentTabId) {
                        this.handleContextMenuAction(item.dataset.action, this.contextMenu.currentTabId);
                        this.hideContextMenu();
                    }
                });

                document.body.appendChild(this.contextMenu);

                // Hide context menu when clicking elsewhere
                document.addEventListener('click', () => {
                    this.hideContextMenu();
                });
            }

            showContextMenu(event, tabId) {
                const tab = this.tabs.get(tabId);
                if (!tab) return;

                this.contextMenu.currentTabId = tabId;
                
                // Update pin text
                const pinText = this.contextMenu.querySelector('.pin-text');
                if (pinText) {
                    pinText.textContent = tab.isPinned ? 'Unpin Tab' : 'Pin Tab';
                }

                // Position menu
                this.contextMenu.style.left = `${event.pageX}px`;
                this.contextMenu.style.top = `${event.pageY}px`;
                this.contextMenu.classList.add('show');
            }

            hideContextMenu() {
                this.contextMenu.classList.remove('show');
            }

            handleContextMenuAction(action, tabId) {
                const tab = this.tabs.get(tabId);
                if (!tab) return;

                switch (action) {
                    case 'reload':
                        if (tab.webviewElement) {
                            tab.webviewElement.reload();
                        }
                        break;
                    case 'duplicate':
                        this.duplicateTab(tabId);
                        break;
                    case 'pin':
                        this.pinTab(tabId);
                        break;
                    case 'close':
                        this.closeTab(tabId);
                        break;
                    case 'close-others':
                        Array.from(this.tabs.keys()).forEach(id => {
                            if (id !== tabId) this.closeTab(id);
                        });
                        break;
                    case 'close-right':
                        const tabElements = Array.from(document.querySelectorAll('.tab'));
                        const targetIndex = tabElements.findIndex(el => el.dataset.tabId === tabId);
                        tabElements.slice(targetIndex + 1).forEach(el => {
                            this.closeTab(el.dataset.tabId);
                        });
                        break;
                }
            }

            setupTabEvents() {
                // New tab button
                const newTabButton = document.querySelector('.new-tab');
                if (newTabButton) {
                    newTabButton.addEventListener('click', () => {
                        const newTabId = this.createTab();
                        this.switchToTab(newTabId);
                    });
                }

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch (e.key) {
                            case 't':
                                e.preventDefault();
                                const newTabId = this.createTab();
                                this.switchToTab(newTabId);
                                break;
                            case 'w':
                                e.preventDefault();
                                if (this.activeTabId) {
                                    this.closeTab(this.activeTabId);
                                }
                                break;
                            case 'Tab':
                                e.preventDefault();
                                this.switchToNextTab(e.shiftKey ? -1 : 1);
                                break;
                        }
                    }

                    // Ctrl+1-9 to switch to specific tabs
                    if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '9') {
                        e.preventDefault();
                        const tabIndex = parseInt(e.key) - 1;
                        const tabIds = Array.from(this.tabs.keys());
                        if (tabIds[tabIndex]) {
                            this.switchToTab(tabIds[tabIndex]);
                        }
                    }
                });
            }

            switchToNextTab(direction = 1) {
                const tabIds = Array.from(this.tabs.keys());
                const currentIndex = tabIds.indexOf(this.activeTabId);
                if (currentIndex === -1) return;

                let nextIndex = currentIndex + direction;
                if (nextIndex >= tabIds.length) nextIndex = 0;
                if (nextIndex < 0) nextIndex = tabIds.length - 1;

                this.switchToTab(tabIds[nextIndex]);
            }

            updateNavigationButtons() {
                const tab = this.tabs.get(this.activeTabId);
                if (!tab || !tab.webviewElement) return;

                const backButton = document.getElementById('backButton');
                const forwardButton = document.getElementById('forwardButton');

                if (backButton) {
                    try {
                        backButton.disabled = !tab.webviewElement.canGoBack();
                    } catch (error) {
                        backButton.disabled = true;
                    }
                }
                if (forwardButton) {
                    try {
                        forwardButton.disabled = !tab.webviewElement.canGoForward();
                    } catch (error) {
                        forwardButton.disabled = true;
                    }
                }
            }

            getActiveTab() {
                return this.tabs.get(this.activeTabId);
            }

            getDefaultFavicon() {
                return "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234a9eff'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z'/%3E%3C/svg%3E";
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // Enhanced MIC Browser Ultimate Implementation
        class MICBrowserUltimate {
            constructor() {
                this.sidebarCollapsed = false;
                this.isVoiceActive = false;
                this.aiContext = new Map();
                this.workflowRecorder = null;
                this.predictiveEngine = null;
                
                // Initialize settings manager
                this.settings = new SettingsManager();
                
                // Initialize tab manager
                this.tabManager = new TabManager();
                
                // Initialize command parser
                this.commandParser = new CommandParser(this);
                
                this.initializeComponents();
                this.setupEventListeners();
                this.startSystemMonitoring();
                
                console.log('🚀 MIC Browser Ultimate initialized with settings and tabbed browsing');
            }

            async initializeComponents() {
                // Show loading overlay
                this.showLoading('Initializing AI systems...');
                
                try {
                    // Initialize subsystems
                    await this.initializeAI();
                    await this.initializeVoice();
                    await this.initializeWorkflows();
                    await this.initializeSecurity();
                    
                    // Setup real-time features
                    this.setupRealtimeFeatures();
                    
                    // Load user preferences
                    await this.loadUserPreferences();
                    
                    // Initialize settings UI
                    this.settings.refreshSettingsUI();
                    this.applySettingsToFeatures();
                    
                    this.hideLoading();
                    this.showNotification('MIC Browser Ultimate is ready!', 'success');
                    
                } catch (error) {
                    console.error('Initialization failed:', error);
                    this.hideLoading();
                    this.showNotification('Initialization failed. Some features may not work properly.', 'error');
                }
            }

            async initializeAI() {
                this.updateLoadingProgress('Loading AI models...');
                
                // Simulate AI initialization
                await this.delay(1000);
                
                this.aiContext.set('status', 'ready');
                this.aiContext.set('model', 'claude-3-sonnet');
                this.aiContext.set('capabilities', ['chat', 'ocr', 'analysis', 'prediction']);
            }

            async initializeVoice() {
                this.updateLoadingProgress('Setting up voice recognition...');
                
                if ('speechSynthesis' in window && 'webkitSpeechRecognition' in window) {
                    this.speechRecognition = new webkitSpeechRecognition();
                    this.speechRecognition.continuous = false;
                    this.speechRecognition.interimResults = false;
                    this.speechRecognition.lang = 'en-US';
                    
                    this.speechRecognition.onresult = (event) => {
                        const command = event.results[0][0].transcript;
                        this.processVoiceCommand(command);
                    };
                    
                    this.speechRecognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        this.showNotification('Voice recognition error', 'error');
                    };
                }
                
                await this.delay(500);
            }

            async initializeWorkflows() {
                this.updateLoadingProgress('Loading workflow engine...');
                
                this.workflows = new Map();
                this.workflows.set('data-transfer', {
                    id: 'data-transfer',
                    name: 'Smart Data Transfer',
                    description: 'Transfer data between applications',
                    steps: ['analyze-source', 'map-fields', 'validate-data', 'transfer', 'verify'],
                    active: true
                });
                
                await this.delay(800);
            }

            async initializeSecurity() {
                this.updateLoadingProgress('Configuring security systems...');
                
                this.security = {
                    encryption: true,
                    auditLogging: true,
                    threatDetection: true,
                    complianceMode: 'standard'
                };
                
                await this.delay(600);
            }

            // Tab Management Integration
            onTabChanged(tabId, tabData) {
                // Update address bar with new tab's URL
                const urlInput = document.getElementById('urlInput');
                if (urlInput && tabData.url !== 'about:blank') {
                    urlInput.value = tabData.url;
                }

                // Update navigation buttons
                this.updateNavigationState(tabData);

                // Sync AI context with new tab
                this.syncAIContext(tabId, tabData);

                // Update page analysis for new tab
                if (tabData.webviewElement) {
                    this.analyzePageContent(tabData.webviewElement);
                }

                console.log(`🔄 Switched to tab: ${tabId} (${tabData.title})`);
            }

            updateNavigationState(tabData) {
                const backButton = document.getElementById('backButton');
                const forwardButton = document.getElementById('forwardButton');
                const refreshButton = document.getElementById('refreshButton');

                if (backButton) backButton.disabled = !tabData.canGoBack;
                if (forwardButton) forwardButton.disabled = !tabData.canGoForward;
                if (refreshButton) refreshButton.disabled = false;
            }

            syncAIContext(tabId, tabData) {
                // Store AI context per tab
                if (!this.aiContext.has(tabId)) {
                    this.aiContext.set(tabId, {
                        history: [],
                        pageContent: null,
                        insights: [],
                        suggestions: []
                    });
                }

                // Update active tab context
                this.aiContext.set('activeTab', tabId);
            }

            async analyzePageContent(webview) {
                try {
                    // Get page content for AI analysis
                    const pageTitle = await webview.executeJavaScript('document.title');
                    const pageUrl = webview.getURL();
                    
                    // Store page info for AI context
                    const activeTabId = this.tabManager.activeTabId;
                    if (this.aiContext.has(activeTabId)) {
                        const tabContext = this.aiContext.get(activeTabId);
                        tabContext.pageContent = {
                            title: pageTitle,
                            url: pageUrl,
                            timestamp: Date.now()
                        };
                    }

                    // Trigger predictive suggestions
                    this.generatePageSuggestions(pageUrl, pageTitle);

                } catch (error) {
                    console.warn('Page analysis failed:', error);
                }
            }

            generatePageSuggestions(url, title) {
                // Simple predictive suggestions based on page content
                const suggestions = [];

                if (url.includes('github.com')) {
                    suggestions.push('Would you like me to analyze this repository?');
                    suggestions.push('I can help you understand the code structure.');
                }

                if (url.includes('stackoverflow.com')) {
                    suggestions.push('I can explain this coding problem in detail.');
                    suggestions.push('Would you like me to provide additional solutions?');
                }

                if (url.includes('youtube.com') || url.includes('vimeo.com')) {
                    suggestions.push('I can create a summary of this video content.');
                    suggestions.push('Would you like me to extract key timestamps?');
                }

                if (suggestions.length > 0) {
                    this.showAISuggestions(suggestions);
                }
            }

            showAISuggestions(suggestions) {
                const suggestionsContainer = document.getElementById('aiSuggestions');
                if (!suggestionsContainer) return;

                suggestionsContainer.innerHTML = suggestions.map(suggestion => 
                    `<div class="suggestion-item" onclick="micBrowser.sendMessage('${suggestion}')">${suggestion}</div>`
                ).join('');
            }

            // Navigation methods for tabs
            navigateActiveTab(url) {
                const activeTab = this.tabManager.getActiveTab();
                if (activeTab && activeTab.webviewElement) {
                    activeTab.webviewElement.loadURL(url);
                }
            }

            refreshActiveTab() {
                const activeTab = this.tabManager.getActiveTab();
                if (activeTab && activeTab.webviewElement) {
                    activeTab.webviewElement.reload();
                }
            }

            goBackActiveTab() {
                const activeTab = this.tabManager.getActiveTab();
                if (activeTab && activeTab.webviewElement) {
                    try {
                        if (activeTab.webviewElement.canGoBack()) {
                            activeTab.webviewElement.goBack();
                        }
                    } catch (error) {
                        console.warn('Navigation back failed:', error);
                    }
                }
            }

            goForwardActiveTab() {
                const activeTab = this.tabManager.getActiveTab();
                if (activeTab && activeTab.webviewElement) {
                    try {
                        if (activeTab.webviewElement.canGoForward()) {
                            activeTab.webviewElement.goForward();
                        }
                    } catch (error) {
                        console.warn('Navigation forward failed:', error);
                    }
                }
            }

            refreshActiveTab() {
                const activeTab = this.tabManager.getActiveTab();
                if (activeTab && activeTab.webviewElement) {
                    try {
                        activeTab.webviewElement.reload();
                    } catch (error) {
                        console.warn('Tab refresh failed:', error);
                    }
                }
            }

            navigateActiveTab(url) {
                const activeTab = this.tabManager.getActiveTab();
                if (activeTab && activeTab.webviewElement) {
                    try {
                        activeTab.webviewElement.src = url;
                        this.updateTabUrl(activeTab.id, url);
                    } catch (error) {
                        console.warn('Navigation failed:', error);
                    }
                }
            }

            async navigateFromUrlBar() {
                const urlInput = document.getElementById('urlInput');
                if (!urlInput) return;

                let input = urlInput.value.trim();
                if (!input) return;

                // Check if input is a command (starts with / or contains command keywords)
                if (input.startsWith('/') || this.isCommand(input)) {
                    await this.executeCommand(input.startsWith('/') ? input.substring(1) : input);
                    return;
                }

                // Regular URL navigation
                let url = input;

                // Add protocol if missing
                if (!url.startsWith('http://') && !url.startsWith('https://') && !url.startsWith('file://')) {
                    // Check if it looks like a URL
                    if (url.includes('.') && !url.includes(' ')) {
                        url = 'https://' + url;
                    } else {
                        // Treat as search query
                        url = `https://www.google.com/search?q=${encodeURIComponent(url)}`;
                    }
                }

                this.navigateActiveTab(url);
            }

            // Check if input looks like a command
            isCommand(input) {
                const commandKeywords = [
                    'go to', 'open', 'search for', 'find', 'create new tab', 'close tab',
                    'go back', 'go forward', 'reload', 'refresh', 'home', 'settings',
                    'scan', 'screenshot', 'ai', 'assistant', 'help', 'voice', 'theme'
                ];
                
                const lowerInput = input.toLowerCase();
                return commandKeywords.some(keyword => lowerInput.startsWith(keyword));
            }

            // Execute command and show result
            async executeCommand(input) {
                try {
                    const result = await this.commandParser.parseCommand(input);
                    
                    if (result.success) {
                        this.showCommandResult(result.result, 'success');
                    } else {
                        this.showCommandResult(result.error, 'error');
                    }
                    
                    // Clear URL input after command execution
                    document.getElementById('urlInput').value = '';
                    
                } catch (error) {
                    console.error('Command execution error:', error);
                    this.showCommandResult('Command execution failed: ' + error.message, 'error');
                }
            }

            // Show command result notification
            showCommandResult(message, type = 'info') {
                // Create or update command result display
                let resultDiv = document.getElementById('commandResult');
                if (!resultDiv) {
                    resultDiv = document.createElement('div');
                    resultDiv.id = 'commandResult';
                    resultDiv.className = 'command-result';
                    document.body.appendChild(resultDiv);
                }

                resultDiv.className = `command-result ${type}`;
                resultDiv.textContent = message;
                resultDiv.style.display = 'block';

                // Auto-hide after 3 seconds
                setTimeout(() => {
                    if (resultDiv) {
                        resultDiv.style.display = 'none';
                    }
                }, 3000);
            }

            setupEventListeners() {
                // Chat input handling
                const chatInput = document.getElementById('chatInput');
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                // Auto-resize textarea
                chatInput.addEventListener('input', () => {
                    chatInput.style.height = 'auto';
                    chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
                });

                // URL bar enhancements with command support
                const urlInput = document.getElementById('urlInput');
                const urlContainer = document.getElementById('urlContainer');
                const commandSuggestions = document.getElementById('commandSuggestions');
                
                if (urlInput) {
                    urlInput.addEventListener('focus', () => {
                        urlInput.select();
                    });

                    urlInput.addEventListener('input', (e) => {
                        const value = e.target.value;
                        
                        // Check if it's a command (starts with / or looks like command)
                        if (value.startsWith('/') || this.isCommand(value)) {
                            urlContainer.classList.add('command-mode');
                            this.showCommandSuggestions(value);
                        } else {
                            urlContainer.classList.remove('command-mode');
                            this.hideCommandSuggestions();
                        }
                    });

                    urlInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Tab' && commandSuggestions.style.display !== 'none') {
                            e.preventDefault();
                            this.selectNextSuggestion();
                        } else if (e.key === 'Escape') {
                            this.hideCommandSuggestions();
                            urlContainer.classList.remove('command-mode');
                        }
                    });

                    urlInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.navigateFromUrlBar();
                        }
                    });

                    urlInput.addEventListener('blur', () => {
                        // Hide suggestions after a delay to allow clicking
                        setTimeout(() => {
                            this.hideCommandSuggestions();
                            urlContainer.classList.remove('command-mode');
                        }, 200);
                    });
                }

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case 'k':
                                e.preventDefault();
                                this.openCommandPalette();
                                break;
                            case 'm':
                                e.preventDefault();
                                this.toggleAssistant();
                                break;
                            case 'j':
                                e.preventDefault();
                                this.startVoiceCommand();
                                break;
                        }
                    }
                });
            }

            setupRealtimeFeatures() {
                // Real-time collaboration
                this.collaboration = {
                    connected: false,
                    users: [],
                    sharedWorkflows: new Map()
                };

                // Performance monitoring
                this.performanceMonitor = {
                    startTime: Date.now(),
                    metrics: {
                        aiRequests: 0,
                        workflowsExecuted: 0,
                        timesSaved: 0,
                        errorsHandled: 0
                    }
                };
            }

            // Command System Functions
            showCommandSuggestions(input) {
                const suggestions = this.commandParser.getSuggestions(input.startsWith('/') ? input.substring(1) : input);
                const suggestionsContainer = document.getElementById('commandSuggestions');
                
                if (suggestions.length === 0) {
                    suggestionsContainer.style.display = 'none';
                    return;
                }

                suggestionsContainer.innerHTML = '';
                suggestions.forEach((suggestion, index) => {
                    const div = document.createElement('div');
                    div.className = 'command-suggestion';
                    if (index === 0) div.classList.add('selected');
                    
                    div.innerHTML = `
                        <div class="suggestion-name">${suggestion.text}</div>
                        <div class="suggestion-description">${suggestion.description}</div>
                        <div class="suggestion-usage">${suggestion.usage}</div>
                    `;
                    
                    div.addEventListener('click', () => {
                        document.getElementById('urlInput').value = '/' + suggestion.text + ' ';
                        document.getElementById('urlInput').focus();
                        this.hideCommandSuggestions();
                    });
                    
                    suggestionsContainer.appendChild(div);
                });
                
                suggestionsContainer.style.display = 'block';
            }

            hideCommandSuggestions() {
                document.getElementById('commandSuggestions').style.display = 'none';
            }

            selectNextSuggestion() {
                const suggestions = document.querySelectorAll('.command-suggestion');
                const selected = document.querySelector('.command-suggestion.selected');
                
                if (!selected || !suggestions.length) return;
                
                selected.classList.remove('selected');
                const nextIndex = Array.from(suggestions).indexOf(selected) + 1;
                const next = suggestions[nextIndex] || suggestions[0];
                next.classList.add('selected');
            }

            openCommandPalette() {
                const palette = document.getElementById('commandPalette');
                const input = document.getElementById('commandPaletteInput');
                
                palette.style.display = 'block';
                input.focus();
                
                this.setupCommandPalette();
            }

            closeCommandPalette() {
                document.getElementById('commandPalette').style.display = 'none';
            }

            setupCommandPalette() {
                const input = document.getElementById('commandPaletteInput');
                const results = document.getElementById('commandPaletteResults');
                
                input.addEventListener('input', (e) => {
                    const query = e.target.value;
                    this.updateCommandPaletteResults(query);
                });
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeCommandPalette();
                    } else if (e.key === 'Enter') {
                        const selected = results.querySelector('.command-suggestion.selected');
                        if (selected) {
                            const command = selected.dataset.command;
                            this.executeCommand(command);
                            this.closeCommandPalette();
                        }
                    }
                });
                
                // Close palette when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.command-palette')) {
                        this.closeCommandPalette();
                    }
                });
            }

            updateCommandPaletteResults(query) {
                const results = document.getElementById('commandPaletteResults');
                const suggestions = this.commandParser.getSuggestions(query);
                const categories = this.commandParser.getCategories();
                
                results.innerHTML = '';
                
                if (query.trim() === '') {
                    // Show all commands by category
                    categories.forEach(category => {
                        const commands = this.commandParser.getCommandsByCategory(category);
                        if (commands.length > 0) {
                            const categoryDiv = document.createElement('div');
                            categoryDiv.className = 'command-category';
                            categoryDiv.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                            results.appendChild(categoryDiv);
                            
                            commands.slice(0, 3).forEach(command => {
                                const div = this.createCommandSuggestionElement(command);
                                results.appendChild(div);
                            });
                        }
                    });
                } else {
                    // Show filtered suggestions
                    suggestions.forEach(suggestion => {
                        const div = this.createCommandSuggestionElement(suggestion);
                        results.appendChild(div);
                    });
                }
            }

            createCommandSuggestionElement(command) {
                const div = document.createElement('div');
                div.className = 'command-suggestion';
                div.dataset.command = command.name || command.text;
                
                div.innerHTML = `
                    <div class="suggestion-name">${command.name || command.text}</div>
                    <div class="suggestion-description">${command.description}</div>
                    <div class="suggestion-usage">${command.usage}</div>
                `;
                
                div.addEventListener('click', () => {
                    this.executeCommand(command.name || command.text);
                    this.closeCommandPalette();
                });
                
                return div;
            }

            async loadUserPreferences() {
                // Load from localStorage or API
                const preferences = JSON.parse(localStorage.getItem('micPreferences') || '{}');
                
                this.userPreferences = {
                    theme: preferences.theme || 'dark',
                    aiModel: preferences.aiModel || 'claude-3-sonnet',
                    voiceEnabled: preferences.voiceEnabled || true,
                    predictiveMode: preferences.predictiveMode || true,
                    securityLevel: preferences.securityLevel || 'standard',
                    ...preferences
                };
            }

            startSystemMonitoring() {
                setInterval(() => {
                    this.updateSystemStatus();
                    this.checkPerformance();
                    this.updateAnalytics();
                }, 5000);

                // Update time display
                setInterval(() => {
                    document.getElementById('systemTime').textContent = new Date().toLocaleTimeString();
                }, 1000);
            }

            // Core Functions
            async sendMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (!message) return;
                
                input.value = '';
                input.style.height = 'auto';
                
                this.addMessage('user', message);
                this.showTypingIndicator();
                
                try {
                    // Process with AI
                    const response = await this.processWithAI(message);
                    
                    this.hideTypingIndicator();
                    this.addMessage('assistant', response.content, response.actions);
                    
                    // Execute any actions
                    if (response.actions) {
                        await this.executeActions(response.actions);
                    }
                    
                    this.performanceMonitor.metrics.aiRequests++;
                    
                } catch (error) {
                    this.hideTypingIndicator();
                    this.addMessage('assistant', 'I encountered an error processing your request. Please try again.');
                    console.error('AI processing error:', error);
                }
            }

            async processWithAI(message) {
                const lowerMessage = message.toLowerCase();
                
                // Handle browser commands locally for immediate response
                const browserCommand = await this.handleBrowserCommands(lowerMessage, message);
                if (browserCommand) {
                    return browserCommand;
                }
                
                // For general AI requests, use the actual AI service
                try {
                    if (window.electronAPI && window.electronAPI.aiRequest) {
                        const result = await window.electronAPI.aiRequest({ 
                            command: message,
                            context: {
                                currentUrl: this.getCurrentUrl(),
                                tabCount: this.tabManager.tabs.size,
                                settings: this.settings ? Object.fromEntries(this.settings.settings) : {}
                            }
                        });
                        
                        if (result.success) {
                            return {
                                content: result.response,
                                actions: this.extractActionsFromAIResponse(result.response)
                            };
                        } else {
                            console.warn('AI request failed:', result.error);
                            return this.getFallbackResponse(message);
                        }
                    } else {
                        return this.getFallbackResponse(message);
                    }
                } catch (error) {
                    console.error('AI processing error:', error);
                    return this.getFallbackResponse(message);
                }
            }

            async handleBrowserCommands(lowerMessage, originalMessage) {
                // Tab-related commands
                if (lowerMessage.includes('new tab') || lowerMessage.includes('open tab')) {
                    const newTabId = this.tabManager.createTab();
                    this.tabManager.switchToTab(newTabId);
                    return {
                        content: "I've opened a new tab for you. You can now navigate to any website.",
                        actions: ['focus-url-bar']
                    };
                }
                
                if (lowerMessage.includes('close tab')) {
                    if (this.tabManager.tabs.size > 1) {
                        this.tabManager.closeTab(this.tabManager.activeTabId);
                        return {
                            content: "I've closed the current tab.",
                            actions: []
                        };
                    } else {
                        return {
                            content: "I can't close the last tab. Would you like me to open a new tab first?",
                            actions: []
                        };
                    }
                }
                
                if (lowerMessage.includes('go to') || lowerMessage.includes('navigate to') || lowerMessage.includes('open')) {
                    // Extract URL from message
                    const urlMatch = originalMessage.match(/(?:go to|navigate to|open)\s+(.+)/i);
                    if (urlMatch) {
                        const url = urlMatch[1].trim();
                        this.navigateActiveTab(url.includes('.') ? `https://${url}` : `https://www.google.com/search?q=${encodeURIComponent(url)}`);
                        return {
                            content: `I'm navigating to ${url} for you.`,
                            actions: []
                        };
                    }
                }
                
                if (lowerMessage.includes('switch to tab') || lowerMessage.includes('tab')) {
                    const numberMatch = originalMessage.match(/\d+/);
                    if (numberMatch) {
                        const tabIndex = parseInt(numberMatch[0]) - 1;
                        const tabIds = Array.from(this.tabManager.tabs.keys());
                        if (tabIds[tabIndex]) {
                            this.tabManager.switchToTab(tabIds[tabIndex]);
                            return {
                                content: `I've switched to tab ${numberMatch[0]}.`,
                                actions: []
                            };
                        }
                    }
                }
                
                if (lowerMessage.includes('reload') || lowerMessage.includes('refresh')) {
                    this.refreshActiveTab();
                    return {
                        content: "I've refreshed the current page.",
                        actions: []
                    };
                }
                
                if (lowerMessage.includes('back') || lowerMessage.includes('go back')) {
                    this.goBackActiveTab();
                    return {
                        content: "I've navigated back to the previous page.",
                        actions: []
                    };
                }
                
                if (lowerMessage.includes('forward') || lowerMessage.includes('go forward')) {
                    this.goForwardActiveTab();
                    return {
                        content: "I've navigated forward to the next page.",
                        actions: []
                    };
                }
                
                // Return null if no browser command matches
                return null;
            }

            getCurrentUrl() {
                const activeTab = this.tabManager.getActiveTab();
                return activeTab ? activeTab.url : 'about:blank';
            }

            extractActionsFromAIResponse(response) {
                const actions = [];
                const lowerResponse = response.toLowerCase();
                
                if (lowerResponse.includes('scan') || lowerResponse.includes('document')) {
                    actions.push('highlight-scan-button');
                }
                if (lowerResponse.includes('workflow') || lowerResponse.includes('automate')) {
                    actions.push('show-workflow-recorder');
                }
                if (lowerResponse.includes('analytics') || lowerResponse.includes('report')) {
                    actions.push('switch-to-analytics');
                }
                if (lowerResponse.includes('settings') || lowerResponse.includes('configure')) {
                    actions.push('open-settings');
                }
                
                return actions;
            }

            getFallbackResponse(message) {
                return {
                    content: `I understand you want help with: "${message}". I can assist you with web browsing, tab management, document scanning, workflow automation, and more. However, I need an AI service to be configured for advanced assistance. Please check your API key settings.`,
                    actions: ['open-settings']
                };
            }

            async executeActions(actions) {
                for (const action of actions) {
                    switch (action) {
                        case 'focus-url-bar':
                            const urlInput = document.getElementById('urlInput');
                            if (urlInput) {
                                urlInput.focus();
                                urlInput.select();
                            }
                            break;
                        case 'open-settings':
                            this.switchSidebarTab('settings');
                            this.toggleAssistant();
                            break;
                        case 'highlight-scan-button':
                            this.highlightElement('.action-btn.primary');
                            break;
                        case 'show-workflow-recorder':
                            this.switchSidebarTab('workflows');
                            break;
                        case 'switch-to-analytics':
                            this.switchSidebarTab('analytics');
                            break;
                        case 'analyze-page-structure':
                            this.analyzeCurrentPage();
                            break;
                        default:
                            console.log('Unknown action:', action);
                    }
                }
            }

            addMessage(role, content, actions = []) {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${role}`;
                
                let actionsHtml = '';
                if (actions && actions.length > 0) {
                    actionsHtml = `
                        <div class="message-actions">
                            ${actions.map(action => `
                                <button class="message-action" onclick="micBrowser.executeAction('${action}')">
                                    ${this.getActionLabel(action)}
                                </button>
                            `).join('')}
                        </div>
                    `;
                }
                
                messageDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-${role === 'user' ? 'user' : 'robot'}"></i>
                    </div>
                    <div class="message-content">
                        ${content}
                        ${actionsHtml}
                    </div>
                `;
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            getActionLabel(action) {
                const labels = {
                    'highlight-scan-button': 'Show Scan',
                    'show-workflow-recorder': 'Create Workflow',
                    'switch-to-analytics': 'View Analytics',
                    'analyze-page-structure': 'Analyze Page',
                    'show-suggestions': 'Show Suggestions'
                };
                return labels[action] || action;
            }

            showTypingIndicator() {
                const chatMessages = document.getElementById('chatMessages');
                const indicator = document.createElement('div');
                indicator.id = 'typingIndicator';
                indicator.className = 'message assistant';
                indicator.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div style="display: flex; gap: 4px; padding: 8px;">
                            <div style="width: 8px; height: 8px; background: var(--text-secondary); border-radius: 50%; animation: typing 1.4s infinite;"></div>
                            <div style="width: 8px; height: 8px; background: var(--text-secondary); border-radius: 50%; animation: typing 1.4s infinite 0.2s;"></div>
                            <div style="width: 8px; height: 8px; background: var(--text-secondary); border-radius: 50%; animation: typing 1.4s infinite 0.4s;"></div>
                        </div>
                    </div>
                `;
                
                chatMessages.appendChild(indicator);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            hideTypingIndicator() {
                const indicator = document.getElementById('typingIndicator');
                if (indicator) {
                    indicator.remove();
                }
            }

            // Interface Functions
            switchSidebarTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                
                // Update panels
                document.querySelectorAll('.sidebar-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(`${tabName}Panel`).classList.add('active');
            }

            toggleAssistant() {
                const sidebar = document.getElementById('aiSidebar');
                sidebar.classList.toggle('collapsed');
                this.sidebarCollapsed = !this.sidebarCollapsed;
                
                if (!this.sidebarCollapsed) {
                    this.showNotification('AI Assistant activated', 'success');
                } else {
                    this.showNotification('AI Assistant minimized', 'info');
                }
            }

            async startVoiceCommand() {
                if (!this.speechRecognition) {
                    this.showNotification('Voice recognition not available', 'error');
                    return;
                }
                
                this.isVoiceActive = true;
                this.showNotification('Listening... Speak your command', 'info');
                
                try {
                    this.speechRecognition.start();
                } catch (error) {
                    this.showNotification('Voice recognition error', 'error');
                    this.isVoiceActive = false;
                }
            }

            async processVoiceCommand(command) {
                this.isVoiceActive = false;
                this.showNotification(`Heard: "${command}"`, 'success');
                
                // Add to chat as user message
                this.addMessage('user', `ðŸŽ¤ ${command}`);
                
                // Process with AI
                this.showTypingIndicator();
                const response = await this.processWithAI(command);
                this.hideTypingIndicator();
                this.addMessage('assistant', response.content, response.actions);
                
                // Execute actions
                if (response.actions) {
                    await this.executeActions(response.actions);
                }
            }

            // Demo Functions
            demoAI() {
                this.switchSidebarTab('chat');
                this.toggleAssistant();
                setTimeout(() => {
                    document.getElementById('chatInput').value = 'Show me what you can do';
                    this.sendMessage();
                }, 500);
            }

            demoScan() {
                this.showNotification('Opening document scanner...', 'info');
                setTimeout(() => {
                    this.showNotification('Demo: Scan feature would open camera or file picker', 'success');
                }, 1000);
            }

            demoWorkflow() {
                this.switchSidebarTab('workflows');
                this.toggleAssistant();
                this.showNotification('Workflow automation demo', 'info');
            }

            demoTransfer() {
                this.addMessage('assistant', 'I can transfer data between any web applications. For example, I could take customer information from your CRM and automatically populate it in your finance system, mapping fields intelligently and validating data.');
                this.toggleAssistant();
            }

            demoVoice() {
                if (this.speechRecognition) {
                    this.startVoiceCommand();
                } else {
                    this.showNotification('Voice demo: "Fill this form with test data"', 'info');
                    setTimeout(() => {
                        this.addMessage('assistant', 'ðŸŽ¤ Voice command received: "Fill this form with test data". I would analyze the current page, identify form fields, and populate them with appropriate test data.');
                    }, 1000);
                }
            }

            demoAnalytics() {
                this.switchSidebarTab('analytics');
                this.toggleAssistant();
                this.updateAnalytics();
                this.showNotification('Analytics dashboard updated', 'success');
            }

            demoSecurity() {
                this.switchSidebarTab('settings');
                this.toggleAssistant();
                this.showNotification('Security features: Encryption, audit logs, compliance monitoring', 'info');
            }

            demoCollaboration() {
                this.showNotification('Collaboration features: Real-time sharing, team workflows, collective intelligence', 'info');
            }

            // Utility Functions
            updateSystemStatus() {
                const statusDot = document.getElementById('systemStatus');
                const statusText = document.getElementById('systemStatusText');
                
                // Simulate system health
                const health = Math.random();
                if (health > 0.8) {
                    statusDot.className = 'status-dot';
                    statusText.textContent = 'System Optimal';
                } else if (health > 0.6) {
                    statusDot.className = 'status-dot warning';
                    statusText.textContent = 'System Normal';
                } else {
                    statusDot.className = 'status-dot error';
                    statusText.textContent = 'System Alert';
                }
                
                // Update memory usage
                const memoryUsage = Math.floor(200 + Math.random() * 100);
                document.getElementById('memoryUsage').textContent = `Memory: ${memoryUsage}MB`;
            }

            checkPerformance() {
                // Monitor performance and show warnings if needed
                const performanceIssues = [];
                
                if (this.performanceMonitor.metrics.errorsHandled > 5) {
                    performanceIssues.push('High error rate detected');
                }
                
                // Show performance notifications
                if (performanceIssues.length > 0) {
                    this.showNotification(performanceIssues[0], 'warning');
                }
            }

            updateAnalytics() {
                // Update analytics with current metrics
                const timeSaved = (2.5 + Math.random() * 3).toFixed(1);
                const tasksAutomated = 30 + Math.floor(Math.random() * 20);
                const accuracyRate = (94 + Math.random() * 5).toFixed(0);
                const valueGenerated = Math.floor(800 + Math.random() * 600);
                
                const metricCards = document.querySelectorAll('.metric-value');
                if (metricCards[0]) metricCards[0].textContent = `${timeSaved}h`;
                if (metricCards[1]) metricCards[1].textContent = tasksAutomated;
                if (metricCards[2]) metricCards[2].textContent = `${accuracyRate}%`;
                if (metricCards[3]) metricCards[3].textContent = `$${valueGenerated}`;
            }

            showNotification(message, type = 'info') {
                const container = document.getElementById('notificationContainer');
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                const icons = {
                    info: 'fa-info-circle',
                    success: 'fa-check-circle',
                    warning: 'fa-exclamation-triangle',
                    error: 'fa-times-circle'
                };
                
                notification.innerHTML = `
                    <i class="notification-icon fas ${icons[type]}"></i>
                    <div class="notification-content">
                        <div class="notification-title">MIC Browser</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close" onclick="this.parentElement.remove()">Ã—</button>
                `;
                
                container.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'notificationSlide 0.4s ease reverse';
                    setTimeout(() => notification.remove(), 400);
                }, 5000);
            }

            showLoading(text = 'Loading...') {
                const overlay = document.getElementById('loadingOverlay');
                const loadingText = document.getElementById('loadingText');
                
                loadingText.textContent = text;
                overlay.classList.add('active');
            }

            updateLoadingProgress(progress) {
                const progressText = document.getElementById('loadingProgress');
                progressText.textContent = progress;
            }

            hideLoading() {
                const overlay = document.getElementById('loadingOverlay');
                overlay.classList.remove('active');
            }

            highlightElement(selector) {
                const element = document.querySelector(selector);
                if (element) {
                    element.style.animation = 'aiPulse 2s ease-in-out 3';
                    setTimeout(() => {
                        element.style.animation = '';
                    }, 6000);
                }
            }

            async analyzeCurrentPage() {
                try {
                    this.showNotification('Analyzing page...', 'info');
                    
                    // Use the command parser to run analysis
                    const result = await this.commandParser.executeCommand('analyze');
                    
                    if (result.success) {
                        this.addMessage('assistant', result.response);
                    } else {
                        this.addMessage('assistant', `Analysis failed: ${result.error}`);
                        this.showNotification('Analysis failed', 'error');
                    }
                } catch (error) {
                    console.error('Page analysis error:', error);
                    this.showNotification('Analysis failed', 'error');
                    this.addMessage('assistant', 'Page analysis encountered an error. Please try again.');
                }
            }

            // Settings Management Methods
            switchSettingsTab(tabName) {
                // Remove active from all tabs and groups
                document.querySelectorAll('.settings-tab.active').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.settings-group.active').forEach(group => {
                    group.classList.remove('active');
                });

                // Activate selected tab and group
                const tab = document.querySelector(`[data-tab="${tabName}"]`);
                const group = document.getElementById(`settings-${tabName}`);
                
                if (tab) tab.classList.add('active');
                if (group) group.classList.add('active');
            }

            async handleImportSettings(fileInput) {
                const file = fileInput.files[0];
                if (!file) return;

                try {
                    const result = await this.settings.importSettings(file);
                    if (result.success) {
                        this.showNotification('Settings imported successfully!', 'success');
                        this.settings.refreshSettingsUI();
                    } else {
                        this.showNotification(result.message, 'error');
                    }
                } catch (error) {
                    this.showNotification('Failed to import settings', 'error');
                }
                
                // Clear the file input
                fileInput.value = '';
            }

            onTabChanged(tabId, tabData) {
                // Update settings based on active tab if needed
                // This allows per-tab settings in the future
                console.log('Tab changed:', tabId, tabData);
            }

            // Settings integration with existing features
            applySettingsToFeatures() {
                // Apply AI settings
                const aiSettings = this.settings.getCategory('ai');
                if (aiSettings['ai.voiceCommands'] === false) {
                    // Disable voice commands
                    this.isVoiceActive = false;
                }

                // Apply browser settings
                const browserSettings = this.settings.getCategory('browser');
                // Apply tab behavior settings to tab manager
                if (this.tabManager) {
                    this.tabManager.settings = browserSettings;
                }

                // Apply appearance settings
                const appearanceSettings = this.settings.getCategory('appearance');
                // Theme and visual settings are handled by SettingsManager

                console.log('Settings applied to features');
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            // Page Analysis UI Methods
            showAnalysisResults(analysis) {
                // Create analysis modal
                const modal = this.createAnalysisModal(analysis);
                document.body.appendChild(modal);
                
                // Show with animation
                requestAnimationFrame(() => {
                    modal.classList.add('active');
                });

                this.showNotification(`Page analysis complete! Overall score: ${analysis.overallScore}/100`, 'success');
            }

            showCategoryAnalysis(category, analysis) {
                // Create category-specific modal
                const modal = this.createCategoryModal(category, analysis);
                document.body.appendChild(modal);
                
                // Show with animation
                requestAnimationFrame(() => {
                    modal.classList.add('active');
                });

                this.showNotification(`${category.toUpperCase()} analysis complete! Score: ${analysis.score}/100`, 'info');
            }

            createAnalysisModal(analysis) {
                const modal = document.createElement('div');
                modal.className = 'analysis-modal';
                modal.innerHTML = `
                    <div class="analysis-modal-content">
                        <div class="analysis-header">
                            <h2>📊 Page Analysis Results</h2>
                            <button class="analysis-close" onclick="this.closest('.analysis-modal').remove()">×</button>
                        </div>
                        <div class="analysis-score">
                            <div class="overall-score">
                                <div class="score-circle" data-score="${analysis.overallScore}">
                                    <span class="score-number">${analysis.overallScore}</span>
                                    <span class="score-label">/100</span>
                                </div>
                                <h3>Overall Score</h3>
                            </div>
                        </div>
                        <div class="analysis-categories">
                            ${Object.entries(analysis.categories).map(([category, data]) => `
                                <div class="category-card" onclick="window.micBrowser.showCategoryDetails('${category}', ${JSON.stringify(data).replace(/"/g, '&quot;')})">
                                    <div class="category-header">
                                        <h4>${this.getCategoryIcon(category)} ${this.capitalize(category)}</h4>
                                        <span class="category-score ${this.getScoreClass(data.score)}">${data.score}/100</span>
                                    </div>
                                    <div class="category-preview">
                                        ${data.issues.length > 0 ? `<p class="issues">⚠️ ${data.issues.length} issues found</p>` : ''}
                                        ${data.recommendations.length > 0 ? `<p class="recommendations">💡 ${data.recommendations.length} recommendations</p>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="analysis-insights">
                            <h3>📝 Key Insights</h3>
                            <ul>
                                ${analysis.insights.map(insight => `<li>${insight}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="analysis-recommendations">
                            <h3>🚀 Top Recommendations</h3>
                            <ul>
                                ${analysis.recommendations.slice(0, 5).map(rec => `<li>${rec}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="analysis-actions">
                            <button onclick="window.micBrowser.exportAnalysis('${analysis.url}', 'json')" class="btn-secondary">
                                📥 Export JSON
                            </button>
                            <button onclick="window.micBrowser.shareAnalysis('${analysis.url}')" class="btn-secondary">
                                📤 Share Results
                            </button>
                            <button onclick="this.closest('.analysis-modal').remove()" class="btn-primary">
                                Close
                            </button>
                        </div>
                    </div>
                `;

                // Add styles if not already added
                if (!document.querySelector('#analysis-modal-styles')) {
                    this.addAnalysisStyles();
                }

                return modal;
            }

            createCategoryModal(category, analysis) {
                const modal = document.createElement('div');
                modal.className = 'analysis-modal category-modal';
                modal.innerHTML = `
                    <div class="analysis-modal-content">
                        <div class="analysis-header">
                            <h2>${this.getCategoryIcon(category)} ${this.capitalize(category)} Analysis</h2>
                            <button class="analysis-close" onclick="this.closest('.analysis-modal').remove()">×</button>
                        </div>
                        <div class="category-score-section">
                            <div class="score-circle ${this.getScoreClass(analysis.score)}" data-score="${analysis.score}">
                                <span class="score-number">${analysis.score}</span>
                                <span class="score-label">/100</span>
                            </div>
                            <div class="score-description">
                                <h3>${this.getScoreDescription(analysis.score)}</h3>
                            </div>
                        </div>
                        
                        ${analysis.metrics && Object.keys(analysis.metrics).length > 0 ? `
                            <div class="metrics-section">
                                <h3>📈 Metrics</h3>
                                <div class="metrics-grid">
                                    ${this.renderMetrics(analysis.metrics)}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${analysis.issues.length > 0 ? `
                            <div class="issues-section">
                                <h3>⚠️ Issues Found (${analysis.issues.length})</h3>
                                <ul class="issues-list">
                                    ${analysis.issues.map(issue => `<li class="issue-item">${issue}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        ${analysis.recommendations.length > 0 ? `
                            <div class="recommendations-section">
                                <h3>💡 Recommendations (${analysis.recommendations.length})</h3>
                                <ul class="recommendations-list">
                                    ${analysis.recommendations.map(rec => `<li class="recommendation-item">${rec}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        <div class="analysis-actions">
                            <button onclick="this.closest('.analysis-modal').remove()" class="btn-primary">
                                Close
                            </button>
                        </div>
                    </div>
                `;

                return modal;
            }

            renderMetrics(metrics) {
                const metricHtml = [];
                
                for (const [key, value] of Object.entries(metrics)) {
                    if (typeof value === 'object' && value !== null) {
                        // Handle nested metrics
                        metricHtml.push(`
                            <div class="metric-group">
                                <h4>${this.capitalize(key)}</h4>
                                ${Object.entries(value).map(([subKey, subValue]) => `
                                    <div class="metric-item">
                                        <span class="metric-label">${this.capitalize(subKey)}:</span>
                                        <span class="metric-value">${this.formatMetricValue(subValue)}</span>
                                    </div>
                                `).join('')}
                            </div>
                        `);
                    } else {
                        metricHtml.push(`
                            <div class="metric-item">
                                <span class="metric-label">${this.capitalize(key)}:</span>
                                <span class="metric-value">${this.formatMetricValue(value)}</span>
                            </div>
                        `);
                    }
                }
                
                return metricHtml.join('');
            }

            formatMetricValue(value) {
                if (typeof value === 'boolean') return value ? '✅' : '❌';
                if (typeof value === 'number') return value.toLocaleString();
                if (Array.isArray(value)) return `${value.length} items`;
                return String(value);
            }

            getCategoryIcon(category) {
                const icons = {
                    content: '📄',
                    seo: '🔍',
                    accessibility: '♿',
                    performance: '⚡',
                    security: '🔒',
                    social: '📱',
                    technical: '⚙️',
                    readability: '📖'
                };
                return icons[category] || '📊';
            }

            getScoreClass(score) {
                if (score >= 80) return 'excellent';
                if (score >= 60) return 'good';
                if (score >= 40) return 'fair';
                return 'poor';
            }

            getScoreDescription(score) {
                if (score >= 90) return 'Excellent';
                if (score >= 80) return 'Good';
                if (score >= 60) return 'Fair';
                if (score >= 40) return 'Needs Improvement';
                return 'Poor';
            }

            capitalize(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            showCategoryDetails(category, data) {
                this.showCategoryAnalysis(category, data);
            }

            async exportAnalysis(url, format = 'json') {
                try {
                    const result = await window.electronAPI.pageAnalysis.exportAnalysis(url, format);
                    if (result.success) {
                        // Create download
                        const blob = new Blob([result.data], { type: 'application/json' });
                        const downloadUrl = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = downloadUrl;
                        a.download = `page-analysis-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(downloadUrl);
                        
                        this.showNotification('Analysis exported successfully!', 'success');
                    } else {
                        this.showNotification('Export failed: ' + result.error, 'error');
                    }
                } catch (error) {
                    console.error('Export error:', error);
                    this.showNotification('Export failed', 'error');
                }
            }

            shareAnalysis(url) {
                // Simple share functionality - copy to clipboard
                const shareText = `Check out this page analysis: Overall score ${this.currentAnalysis?.overallScore || 'N/A'}/100 for ${url}`;
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(shareText).then(() => {
                        this.showNotification('Analysis summary copied to clipboard!', 'success');
                    });
                } else {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = shareText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    this.showNotification('Analysis summary copied to clipboard!', 'success');
                }
            }

            addAnalysisStyles() {
                const styles = document.createElement('style');
                styles.id = 'analysis-modal-styles';
                styles.textContent = `
                    .analysis-modal {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.8);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        z-index: 10000;
                        opacity: 0;
                        transition: opacity 0.3s ease;
                    }
                    
                    .analysis-modal.active {
                        opacity: 1;
                    }
                    
                    .analysis-modal-content {
                        background: #1a1a1a;
                        border-radius: 12px;
                        padding: 24px;
                        max-width: 900px;
                        max-height: 90vh;
                        overflow-y: auto;
                        color: #ffffff;
                        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                        border: 1px solid #333;
                    }
                    
                    .analysis-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 24px;
                        border-bottom: 1px solid #333;
                        padding-bottom: 16px;
                    }
                    
                    .analysis-header h2 {
                        margin: 0;
                        color: #4fc3f7;
                    }
                    
                    .analysis-close {
                        background: #ff4444;
                        border: none;
                        color: white;
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        cursor: pointer;
                        font-size: 18px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }
                    
                    .analysis-score {
                        text-align: center;
                        margin-bottom: 32px;
                    }
                    
                    .overall-score {
                        display: inline-block;
                    }
                    
                    .score-circle {
                        width: 120px;
                        height: 120px;
                        border-radius: 50%;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        margin: 0 auto 16px;
                        position: relative;
                    }
                    
                    .score-circle.excellent {
                        background: linear-gradient(135deg, #4caf50, #2e7d32);
                        box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
                    }
                    
                    .score-circle.good {
                        background: linear-gradient(135deg, #2196f3, #1565c0);
                        box-shadow: 0 0 20px rgba(33, 150, 243, 0.3);
                    }
                    
                    .score-circle.fair {
                        background: linear-gradient(135deg, #ff9800, #f57c00);
                        box-shadow: 0 0 20px rgba(255, 152, 0, 0.3);
                    }
                    
                    .score-circle.poor {
                        background: linear-gradient(135deg, #f44336, #c62828);
                        box-shadow: 0 0 20px rgba(244, 67, 54, 0.3);
                    }
                    
                    .score-number {
                        font-size: 32px;
                        font-weight: bold;
                        line-height: 1;
                    }
                    
                    .score-label {
                        font-size: 14px;
                        opacity: 0.8;
                    }
                    
                    .analysis-categories {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 16px;
                        margin-bottom: 32px;
                    }
                    
                    .category-card {
                        background: #262626;
                        border-radius: 8px;
                        padding: 16px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        border: 1px solid #333;
                    }
                    
                    .category-card:hover {
                        background: #333;
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                    }
                    
                    .category-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 12px;
                    }
                    
                    .category-header h4 {
                        margin: 0;
                        font-size: 16px;
                    }
                    
                    .category-score {
                        padding: 4px 12px;
                        border-radius: 20px;
                        font-size: 14px;
                        font-weight: bold;
                    }
                    
                    .category-score.excellent { background: #4caf50; }
                    .category-score.good { background: #2196f3; }
                    .category-score.fair { background: #ff9800; }
                    .category-score.poor { background: #f44336; }
                    
                    .category-preview p {
                        margin: 4px 0;
                        font-size: 14px;
                        opacity: 0.8;
                    }
                    
                    .analysis-insights,
                    .analysis-recommendations {
                        margin-bottom: 24px;
                    }
                    
                    .analysis-insights h3,
                    .analysis-recommendations h3 {
                        color: #4fc3f7;
                        margin-bottom: 12px;
                    }
                    
                    .analysis-insights ul,
                    .analysis-recommendations ul {
                        list-style: none;
                        padding: 0;
                    }
                    
                    .analysis-insights li,
                    .analysis-recommendations li {
                        padding: 8px 0;
                        border-bottom: 1px solid #333;
                    }
                    
                    .analysis-actions {
                        display: flex;
                        gap: 12px;
                        justify-content: flex-end;
                        margin-top: 32px;
                        padding-top: 24px;
                        border-top: 1px solid #333;
                    }
                    
                    .btn-primary,
                    .btn-secondary {
                        padding: 10px 20px;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 14px;
                        transition: all 0.3s ease;
                    }
                    
                    .btn-primary {
                        background: #4fc3f7;
                        color: #000;
                    }
                    
                    .btn-primary:hover {
                        background: #29b6f6;
                    }
                    
                    .btn-secondary {
                        background: #666;
                        color: #fff;
                    }
                    
                    .btn-secondary:hover {
                        background: #777;
                    }
                    
                    .metrics-section,
                    .issues-section,
                    .recommendations-section {
                        margin-bottom: 24px;
                    }
                    
                    .metrics-section h3,
                    .issues-section h3,
                    .recommendations-section h3 {
                        color: #4fc3f7;
                        margin-bottom: 16px;
                    }
                    
                    .metrics-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                        gap: 16px;
                    }
                    
                    .metric-group {
                        background: #262626;
                        padding: 16px;
                        border-radius: 8px;
                        border: 1px solid #333;
                    }
                    
                    .metric-group h4 {
                        margin: 0 0 12px 0;
                        color: #4fc3f7;
                        font-size: 14px;
                    }
                    
                    .metric-item {
                        display: flex;
                        justify-content: space-between;
                        padding: 6px 0;
                        border-bottom: 1px solid #333;
                    }
                    
                    .metric-item:last-child {
                        border-bottom: none;
                    }
                    
                    .metric-label {
                        opacity: 0.8;
                        font-size: 14px;
                    }
                    
                    .metric-value {
                        font-weight: bold;
                        color: #4fc3f7;
                        font-size: 14px;
                    }
                    
                    .issues-list,
                    .recommendations-list {
                        list-style: none;
                        padding: 0;
                    }
                    
                    .issue-item,
                    .recommendation-item {
                        padding: 12px;
                        margin: 8px 0;
                        border-radius: 6px;
                        border-left: 4px solid;
                    }
                    
                    .issue-item {
                        background: rgba(244, 67, 54, 0.1);
                        border-left-color: #f44336;
                        color: #ffcdd2;
                    }
                    
                    .recommendation-item {
                        background: rgba(76, 175, 80, 0.1);
                        border-left-color: #4caf50;
                        color: #c8e6c9;
                    }
                    
                    @media (max-width: 768px) {
                        .analysis-modal-content {
                            margin: 20px;
                            max-height: calc(100vh - 40px);
                        }
                        
                        .analysis-categories {
                            grid-template-columns: 1fr;
                        }
                        
                        .analysis-actions {
                            flex-direction: column;
                        }
                    }
                `;
                document.head.appendChild(styles);
            }
        }

        // Global functions for UI interactions
        function switchSidebarTab(tabName) {
            if (window.micBrowser) {
                window.micBrowser.switchSidebarTab(tabName);
            }
        }

        function toggleAssistant() {
            if (window.micBrowser) {
                window.micBrowser.toggleAssistant();
            }
        }

        function sendMessage() {
            if (window.micBrowser) {
                window.micBrowser.sendMessage();
            }
        }

        function startVoiceCommand() {
            if (window.micBrowser) {
                window.micBrowser.startVoiceCommand();
            }
        }

        function quickScan() {
            openDocumentScanner();
        }

        function showAnalytics() {
            if (window.micBrowser) {
                window.micBrowser.demoAnalytics();
            }
        }

        function quickAction(action) {
            if (!window.micBrowser) return;
            
            switch(action) {
                case 'scan':
                    window.micBrowser.demoScan();
                    break;
                case 'analyze':
                    window.micBrowser.analyzeCurrentPage();
                    break;
                case 'automate':
                    window.micBrowser.demoWorkflow();
                    break;
            }
        }

        // Demo functions
        function demoAI() { if (window.micBrowser) window.micBrowser.demoAI(); }
        function demoScan() { if (window.micBrowser) window.micBrowser.demoScan(); }
        function demoWorkflow() { if (window.micBrowser) window.micBrowser.demoWorkflow(); }
        function demoTransfer() { if (window.micBrowser) window.micBrowser.demoTransfer(); }
        function demoVoice() { if (window.micBrowser) window.micBrowser.demoVoice(); }
        function demoAnalytics() { if (window.micBrowser) window.micBrowser.demoAnalytics(); }
        function demoSecurity() { if (window.micBrowser) window.micBrowser.demoSecurity(); }
        function demoCollaboration() { if (window.micBrowser) window.micBrowser.demoCollaboration(); }

        // Navigation functions
        function navigateBack() {
            micBrowser.showNotification('Navigating back', 'info');
        }

        function navigateForward() {
            micBrowser.showNotification('Navigating forward', 'info');
        }

        function reloadPage() {
            micBrowser.showNotification('Page reloaded', 'success');
        }

        function goHome() {
            micBrowser.showNotification('Navigating to home', 'info');
        }

        // Initialize the application
        let micBrowser;
        document.addEventListener('DOMContentLoaded', () => {
            // Add custom CSS for typing animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes typing {
                    0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
                    30% { transform: translateY(-10px); opacity: 1; }
                }
                
                .toggle-switch {
                    position: relative;
                    width: 48px;
                    height: 24px;
                    background: rgba(255,255,255,0.2);
                    border-radius: 12px;
                    cursor: pointer;
                    transition: background 0.3s ease;
                }
                
                .toggle-switch.active {
                    background: var(--accent-blue);
                }
                
                .toggle-slider {
                    position: absolute;
                    top: 2px;
                    left: 2px;
                    width: 20px;
                    height: 20px;
                    background: white;
                    border-radius: 50%;
                    transition: transform 0.3s ease;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
                }
                
                .toggle-switch.active .toggle-slider {
                    transform: translateX(24px);
                }

                /* Enhanced Settings Panel Styles */
                .settings-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 20px;
                    padding-bottom: 15px;
                    border-bottom: 1px solid var(--dark-border);
                }

                .settings-header h3 {
                    color: white;
                    font-size: 18px;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }

                .settings-actions {
                    display: flex;
                    gap: 8px;
                }

                .settings-btn {
                    background: var(--dark-elevated);
                    border: 1px solid var(--dark-border);
                    color: var(--text-secondary);
                    width: 32px;
                    height: 32px;
                    border-radius: 6px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    transition: all 0.2s ease;
                }

                .settings-btn:hover {
                    background: var(--accent-blue);
                    color: white;
                    transform: translateY(-1px);
                }

                .settings-tabs {
                    display: flex;
                    gap: 4px;
                    margin-bottom: 20px;
                    overflow-x: auto;
                    scrollbar-width: none;
                }

                .settings-tabs::-webkit-scrollbar {
                    display: none;
                }

                .settings-tab {
                    background: rgba(255,255,255,0.05);
                    border: 1px solid rgba(255,255,255,0.1);
                    color: var(--text-secondary);
                    padding: 8px 12px;
                    border-radius: 6px;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    white-space: nowrap;
                    font-size: 12px;
                    display: flex;
                    align-items: center;
                    gap: 6px;
                }

                .settings-tab:hover {
                    background: rgba(255,255,255,0.1);
                    color: var(--text-primary);
                }

                .settings-tab.active {
                    background: var(--accent-blue);
                    border-color: var(--accent-blue);
                    color: white;
                }

                .settings-content {
                    height: calc(100% - 120px);
                    overflow-y: auto;
                    scrollbar-width: thin;
                }

                .settings-group {
                    display: none;
                }

                .settings-group.active {
                    display: block;
                }

                .setting-section {
                    background: rgba(255,255,255,0.05);
                    border-radius: 12px;
                    padding: 16px;
                    margin-bottom: 16px;
                }

                .setting-section h4 {
                    color: white;
                    font-size: 14px;
                    margin-bottom: 16px;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }

                .setting-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 12px;
                    padding: 8px 0;
                }

                .setting-item:last-child {
                    margin-bottom: 0;
                }

                .setting-item label {
                    color: var(--text-primary);
                    font-size: 14px;
                    flex: 1;
                }

                .setting-select {
                    background: var(--dark-elevated);
                    border: 1px solid var(--dark-border);
                    color: var(--text-primary);
                    padding: 6px 10px;
                    border-radius: 6px;
                    font-size: 13px;
                    min-width: 120px;
                }

                .setting-input {
                    background: var(--dark-elevated);
                    border: 1px solid var(--dark-border);
                    color: var(--text-primary);
                    padding: 6px 10px;
                    border-radius: 6px;
                    font-size: 13px;
                    min-width: 120px;
                }

                .setting-input:focus,
                .setting-select:focus {
                    outline: none;
                    border-color: var(--accent-blue);
                    box-shadow: 0 0 0 2px rgba(59,130,246,0.2);
                }

                .range-setting {
                    flex-direction: column;
                    align-items: stretch;
                }

                .range-container {
                    margin-top: 8px;
                }

                .setting-range {
                    width: 100%;
                    accent-color: var(--accent-blue);
                    margin-bottom: 8px;
                }

                .range-labels {
                    display: flex;
                    justify-content: space-between;
                    font-size: 11px;
                    color: var(--text-secondary);
                }

                .range-value {
                    text-align: center;
                    font-size: 12px;
                    color: var(--accent-blue);
                    font-weight: 500;
                    margin-top: 4px;
                }

                /* Settings Panel Animations */
                .settings-group {
                    animation: settingsFadeIn 0.3s ease;
                }

                @keyframes settingsFadeIn {
                    from {
                        opacity: 0;
                        transform: translateY(10px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                .setting-item {
                    transition: background 0.2s ease;
                }

                .setting-item:hover {
                    background: rgba(255,255,255,0.02);
                    border-radius: 6px;
                }
            `;
            document.head.appendChild(style);
            
            // Initialize MIC Browser Ultimate
            window.micBrowser = new MICBrowserUltimate();
        });

        // Add toggle switch functionality
        document.addEventListener('click', (e) => {
            if (e.target.closest('.toggle-switch')) {
                e.target.closest('.toggle-switch').classList.toggle('active');
            }
        });

        // Document Scanner Functions
        let currentImageData = null;
        let ocrInProgress = false;

        function openDocumentScanner() {
            document.getElementById('documentScannerModal').style.display = 'flex';
            resetScanner();
            initializeScannerDefaults();
        }

        function initializeScannerDefaults() {
            const settingsManager = window.micBrowser?.settingsManager;
            if (settingsManager) {
                document.getElementById('ocrLanguage').value = settingsManager.get('ocr.defaultLanguage', 'eng');
                document.getElementById('ocrMode').value = settingsManager.get('ocr.scanMode', 3);
                document.getElementById('preserveSpaces').checked = settingsManager.get('ocr.preserveSpaces', true);
            }
        }

        function closeDocumentScanner() {
            document.getElementById('documentScannerModal').style.display = 'none';
            resetScanner();
        }

        function resetScanner() {
            currentImageData = null;
            ocrInProgress = false;
            document.getElementById('scanProgress').style.display = 'none';
            document.getElementById('scanResults').style.display = 'none';
            document.getElementById('uploadArea').style.display = 'block';
            document.getElementById('extractedText').value = '';
            document.getElementById('confidenceScore').textContent = '0%';
            document.getElementById('wordCount').textContent = '0';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('progressText').textContent = 'Initializing OCR...';
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function processFile(file) {
            if (ocrInProgress) {
                showNotification('OCR processing already in progress', 'warning');
                return;
            }

            const validTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/bmp', 'image/tiff', 'application/pdf'];
            if (!validTypes.includes(file.type)) {
                showNotification('Please select a valid image or PDF file', 'error');
                return;
            }

            if (file.size > 10 * 1024 * 1024) { // 10MB limit
                showNotification('File size too large. Please select a file under 10MB', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                currentImageData = e.target.result;
                startOCR();
            };
            reader.readAsDataURL(file);
        }

        async function startOCR() {
            if (!currentImageData || ocrInProgress) return;

            ocrInProgress = true;
            document.getElementById('uploadArea').style.display = 'none';
            document.getElementById('scanProgress').style.display = 'block';
            document.getElementById('scanResults').style.display = 'none';

            // Get options from UI or settings
            const settingsManager = window.micBrowser?.settingsManager;
            const options = {
                language: document.getElementById('ocrLanguage').value || (settingsManager ? settingsManager.get('ocr.defaultLanguage', 'eng') : 'eng'),
                psm: parseInt(document.getElementById('ocrMode').value) || (settingsManager ? settingsManager.get('ocr.scanMode', 3) : 3),
                preserveInterword: document.getElementById('preserveSpaces').checked !== undefined ? 
                    document.getElementById('preserveSpaces').checked : 
                    (settingsManager ? settingsManager.get('ocr.preserveSpaces', true) : true)
            };

            try {
                // Listen for progress updates
                window.electronAPI.onNewTab((event, data) => {
                    if (data.type === 'ocr-progress') {
                        updateProgress(data.progress, data.status);
                    }
                });

                const result = await window.electronAPI.scanDocument(currentImageData, options);

                if (result.success) {
                    displayResults(result);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('OCR Error:', error);
                showNotification('OCR processing failed: ' + error.message, 'error');
                resetScanner();
            } finally {
                ocrInProgress = false;
            }
        }

        function updateProgress(progress, status) {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressFill.style.width = (progress * 100) + '%';
            progressText.textContent = status + ' (' + Math.round(progress * 100) + '%)';
        }

        function displayResults(result) {
            document.getElementById('scanProgress').style.display = 'none';
            document.getElementById('scanResults').style.display = 'block';
            
            document.getElementById('extractedText').value = result.text;
            document.getElementById('confidenceScore').textContent = Math.round(result.confidence) + '%';
            document.getElementById('wordCount').textContent = result.words ? result.words.length : 0;
        }

        function copyText() {
            const textArea = document.getElementById('extractedText');
            textArea.select();
            textArea.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                showNotification('Text copied to clipboard!', 'success');
            } catch (error) {
                console.error('Copy failed:', error);
                showNotification('Failed to copy text', 'error');
            }
        }

        function downloadText() {
            const text = document.getElementById('extractedText').value;
            if (!text.trim()) {
                showNotification('No text to download', 'warning');
                return;
            }

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'extracted-text-' + new Date().toISOString().slice(0, 19).replace(/:/g, '-') + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Text file downloaded!', 'success');
        }

        async function sendToAI() {
            const text = document.getElementById('extractedText').value;
            if (!text.trim()) {
                showNotification('No text to send to AI', 'warning');
                return;
            }

            try {
                const response = await window.electronAPI.aiRequest({
                    command: `Please analyze and summarize this extracted text from a document:\n\n${text}`
                });

                if (response.success) {
                    // Create a new tab or panel to show AI analysis
                    showNotification('AI analysis complete! Check the assistant panel.', 'success');
                    
                    // You could also display the result in a modal or send it to the AI assistant
                    if (window.micBrowser && window.micBrowser.addAIResponse) {
                        window.micBrowser.addAIResponse(response.response);
                    }
                } else {
                    showNotification('AI analysis failed: ' + response.error, 'error');
                }
            } catch (error) {
                console.error('AI request failed:', error);
                showNotification('Failed to send text to AI', 'error');
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', (event) => {
            const modal = document.getElementById('documentScannerModal');
            if (event.target === modal) {
                closeDocumentScanner();
            }
        });

        // Keyboard shortcuts for document scanner
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                const modal = document.getElementById('documentScannerModal');
                if (modal.style.display === 'flex') {
                    closeDocumentScanner();
                }
            }
        });

        // Auto-updater functions
        let updateInfo = null;

        function showUpdateModal(info) {
            updateInfo = info;
            
            document.getElementById('currentVersion').textContent = info.currentVersion || '1.0.0';
            document.getElementById('newVersion').textContent = info.version || '1.0.1';
            
            const releaseNotes = document.getElementById('releaseNotes');
            if (info.releaseNotes) {
                releaseNotes.innerHTML = `<p>${info.releaseNotes}</p>`;
            } else {
                releaseNotes.innerHTML = `
                    <ul>
                        <li>Performance improvements</li>
                        <li>Bug fixes and stability enhancements</li>
                        <li>Updated dependencies</li>
                        <li>Enhanced security features</li>
                    </ul>
                `;
            }
            
            // Reset UI state
            document.getElementById('updateProgress').style.display = 'none';
            document.getElementById('downloadUpdateBtn').style.display = 'flex';
            document.getElementById('restartBtn').style.display = 'none';
            document.getElementById('updateLaterBtn').style.display = 'flex';
            
            document.getElementById('updateModal').style.display = 'flex';
        }

        function closeUpdateModal() {
            document.getElementById('updateModal').style.display = 'none';
        }

        async function downloadUpdate() {
            try {
                document.getElementById('downloadUpdateBtn').style.display = 'none';
                document.getElementById('updateLaterBtn').style.display = 'none';
                document.getElementById('updateProgress').style.display = 'block';
                document.getElementById('progressText').textContent = 'Starting download...';
                
                const result = await window.electronAPI.updater.downloadUpdate();
                
                if (result.success) {
                    document.getElementById('progressText').textContent = 'Download started...';
                } else {
                    showNotification('Update download failed: ' + result.error, 'error');
                    resetUpdateModal();
                }
            } catch (error) {
                console.error('Download update error:', error);
                showNotification('Failed to start update download', 'error');
                resetUpdateModal();
            }
        }

        async function restartAndUpdate() {
            try {
                const result = await window.electronAPI.updater.quitAndInstall();
                if (!result.success) {
                    showNotification('Failed to restart and update: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Restart and update error:', error);
                showNotification('Failed to restart application', 'error');
            }
        }

        function resetUpdateModal() {
            document.getElementById('updateProgress').style.display = 'none';
            document.getElementById('downloadUpdateBtn').style.display = 'flex';
            document.getElementById('restartBtn').style.display = 'none';
            document.getElementById('updateLaterBtn').style.display = 'flex';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('progressPercentage').textContent = '0%';
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatSpeed(bytesPerSecond) {
            return formatBytes(bytesPerSecond) + '/s';
        }

        // Setup update event listeners when page loads
        if (window.electronAPI && window.electronAPI.updater) {
            // Listen for update events
            window.electronAPI.updater.onUpdateAvailable((event, info) => {
                console.log('Update available:', info);
                showUpdateModal({
                    currentVersion: '1.0.0', // Will be updated with actual version
                    version: info.version,
                    releaseNotes: info.releaseNotes || null
                });
            });

            window.electronAPI.updater.onDownloadProgress((event, progressObj) => {
                const percent = Math.round(progressObj.percent);
                document.getElementById('progressFill').style.width = percent + '%';
                document.getElementById('progressPercentage').textContent = percent + '%';
                document.getElementById('progressText').textContent = 'Downloading update...';
                document.getElementById('downloadSpeed').textContent = formatSpeed(progressObj.bytesPerSecond);
                document.getElementById('downloadSize').textContent = 
                    formatBytes(progressObj.transferred) + ' / ' + formatBytes(progressObj.total);
            });

            window.electronAPI.updater.onUpdateDownloaded((event, info) => {
                console.log('Update downloaded:', info);
                document.getElementById('progressText').textContent = 'Update ready to install';
                document.getElementById('downloadUpdateBtn').style.display = 'none';
                document.getElementById('restartBtn').style.display = 'flex';
                document.getElementById('updateLaterBtn').textContent = 'Install Later';
                document.getElementById('updateLaterBtn').style.display = 'flex';
                showNotification('Update downloaded successfully! Restart to apply.', 'success');
            });

            window.electronAPI.updater.onUpdateError((event, error) => {
                console.error('Update error:', error);
                showNotification('Update failed: ' + error, 'error');
                resetUpdateModal();
            });

            window.electronAPI.updater.onUpdateNotAvailable((event, info) => {
                console.log('No updates available');
            });

            window.electronAPI.updater.onUpdateChecking((event) => {
                console.log('Checking for updates...');
            });

            // Get current version
            window.electronAPI.updater.getVersion().then(versionInfo => {
                console.log('App version:', versionInfo);
            });
        }

        // Platform-specific event handlers
        if (window.electronAPI && window.electronAPI.platform) {
            // Get platform info
            window.electronAPI.platform.getInfo().then(platformInfo => {
                console.log('Platform info:', platformInfo);
                
                // Show platform-specific features in UI
                if (platformInfo.features.jumpList) {
                    console.log('✅ Windows Jump List available');
                }
                if (platformInfo.features.touchBar) {
                    console.log('✅ macOS Touch Bar available');
                }
                if (platformInfo.features.dock) {
                    console.log('✅ macOS Dock integration available');
                }
            });

            // Handle thumbnail toolbar actions (Windows)
            window.electronAPI.platform.onThumbnailAction((event, action) => {
                console.log('Thumbnail action:', action);
                handlePlatformAction(action);
            });

            // Handle Touch Bar actions (macOS)
            window.electronAPI.platform.onTouchBarAction((event, action) => {
                console.log('Touch Bar action:', action);
                handlePlatformAction(action);
            });

            // Handle Dock actions (macOS)
            window.electronAPI.platform.onDockAction((event, action) => {
                console.log('Dock action:', action);
                handlePlatformAction(action);
            });

            // Handle system tray actions
            window.electronAPI.platform.onTrayAction((event, action) => {
                console.log('Tray action:', action);
                handlePlatformAction(action);
            });

            // Handle menu actions (macOS)
            window.electronAPI.platform.onMenuAction((event, action) => {
                console.log('Menu action:', action);
                handlePlatformAction(action);
            });
        }

        // Manual update check function (can be called from UI)
        async function checkForUpdates() {
            try {
                showNotification('Checking for updates...', 'info');
                const result = await window.electronAPI.updater.checkForUpdates();
                
                if (result.success) {
                    if (!result.result) {
                        showNotification('You are running the latest version!', 'success');
                    }
                } else {
                    showNotification('Failed to check for updates: ' + result.error, 'warning');
                }
            } catch (error) {
                console.error('Check for updates error:', error);
                showNotification('Update check failed', 'error');
            }
        }

        // Handle platform-specific actions
        function handlePlatformAction(action) {
            switch (action) {
                case 'new-tab':
                    if (window.micBrowser && window.micBrowser.tabManager) {
                        window.micBrowser.tabManager.createTab('https://www.google.com', 'New Tab');
                    }
                    break;
                    
                case 'prev-tab':
                    if (window.micBrowser && window.micBrowser.tabManager) {
                        window.micBrowser.tabManager.switchToPrevious();
                    }
                    break;
                    
                case 'next-tab':
                    if (window.micBrowser && window.micBrowser.tabManager) {
                        window.micBrowser.tabManager.switchToNext();
                    }
                    break;
                    
                case 'close-tab':
                    if (window.micBrowser && window.micBrowser.tabManager) {
                        window.micBrowser.tabManager.closeCurrentTab();
                    }
                    break;
                    
                case 'scan-document':
                    openDocumentScanner();
                    break;
                    
                case 'voice-assistant':
                    if (window.micBrowser) {
                        window.micBrowser.toggleAssistant();
                    }
                    break;
                    
                case 'analyze-page':
                    if (window.micBrowser) {
                        window.micBrowser.analyzeCurrentPage();
                    }
                    break;
                    
                case 'settings':
                case 'preferences':
                    if (window.micBrowser) {
                        window.micBrowser.switchSidebarTab('settings');
                    }
                    break;
                    
                default:
                    console.log('Unknown platform action:', action);
            }
        }

        // Progress bar integration for platform features
        function updatePlatformProgress(progress) {
            if (window.electronAPI && window.electronAPI.platform) {
                window.electronAPI.platform.updateProgress(progress);
            }
        }

        function clearPlatformProgress() {
            if (window.electronAPI && window.electronAPI.platform) {
                window.electronAPI.platform.clearProgress();
            }
        }

        // Enhanced notification function using platform features
        function showPlatformNotification(title, body, options = {}) {
            if (window.electronAPI && window.electronAPI.platform) {
                return window.electronAPI.platform.showNotification(title, body, options);
            } else {
                return showNotification(title, 'info');
            }
        }

        // Handle escape key for update modal
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                const updateModal = document.getElementById('updateModal');
                if (updateModal.style.display === 'flex') {
                    closeUpdateModal();
                }
            }
        });
    </script>
</body>
</html>